window.__require=function t(e,i,r){function n(o,h){if(!i[o]){if(!e[o]){var c=o.split("/");if(c=c[c.length-1],!e[c]){var a="function"==typeof __require&&__require;if(!h&&a)return a(c,!0);if(s)return s(c,!0);throw new Error("Cannot find module '"+o+"'")}o=c}var u=i[o]={exports:{}};e[o][0].call(u.exports,function(t){return n(e[o][1][t]||t)},u,u.exports,t,e,i,r)}return i[o].exports}for(var s="function"==typeof __require&&__require,o=0;o<r.length;o++)n(r[o]);return n}({LowPolyWater:[function(t,e,i){"use strict";cc._RF.push(e,"f7631WjSoBERZM1bCn4RDrf","LowPolyWater"),Object.defineProperty(i,"__esModule",{value:!0});var r=cc.gfx,n=cc._decorator,s=n.ccclass,o=n.property,h=n.requireComponent,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lengthPtNum=5,e.widthPtNum=5,e.unitSize=40,e.meshRenderer=null,e.gridMesh=null,e}return __extends(e,t),e.prototype.onLoad=function(){cc.dynamicAtlasManager.enabled=!1,cc.game.setFrameRate(60),this.checkGridSize(),this.gridMesh=new a,this.meshRenderer=this.getComponent(cc.MeshRenderer),this.meshRenderer.mesh=this.gridMesh.createMesh(this.lengthPtNum,this.widthPtNum,this.unitSize,40,-40),this.node.is3DNode=!0},e.prototype.start=function(){var t=this,e=cc.Camera.findCamera(this.node).node.convertToWorldSpaceAR(cc.v3(0,0,0)),i=this.node.convertToWorldSpaceAR(cc.v3(100,200,-100));this.getMaterial().setProperty("viewPos",new cc.Vec4(e.x,e.y,e.z,1)),this.getMaterial().setProperty("lightPos",new cc.Vec4(i.x,i.y,i.z,1));var r=function(e){var i=e.getLocation(),r=t.node.convertToNodeSpaceAR(cc.v3(i.x,i.y,0));t.gridMesh.addForce(30,r.x,r.z-r.y)};cc.find("Canvas").on(cc.Node.EventType.TOUCH_START,r),cc.find("Canvas").on(cc.Node.EventType.TOUCH_MOVE,r)},e.prototype.update=function(t){this.gridMesh&&this.gridMesh.update(t)},e.prototype.checkGridSize=function(){this.lengthPtNum=Math.round(this.lengthPtNum),this.widthPtNum=Math.round(this.widthPtNum),this.lengthPtNum%2==0&&(this.lengthPtNum+=1),this.widthPtNum%2==0&&(this.widthPtNum+=1),this.lengthPtNum=Math.max(3,this.lengthPtNum),this.widthPtNum=Math.max(3,this.widthPtNum)},e.prototype.getMaterial=function(){return this.meshRenderer?this.meshRenderer.getMaterial(0):null},__decorate([o],e.prototype,"lengthPtNum",void 0),__decorate([o],e.prototype,"widthPtNum",void 0),__decorate([o],e.prototype,"unitSize",void 0),__decorate([s,h(cc.MeshRenderer)],e)}(cc.Component);i.default=c;var a=function(){function t(){this.lPtNum=-1,this.wPtNum=-1,this.uSize=-1,this.va=null,this.na=null,this.faceNormal=null,this.topology=null,this.mesh=null,this.ripple=null,this.maxH=0,this.minH=0}return t.prototype.update=function(t){this.ripple.update(t),this.setHeights(this.maxH,this.minH),this.calcNormals(),this.mesh.setVertices(r.ATTR_POSITION,this.va),this.mesh.setVertices(r.ATTR_NORMAL,this.na)},t.prototype.createMesh=function(t,e,i,n,s){this.lPtNum=t,this.wPtNum=e,this.uSize=i,this.maxH=n,this.minH=s,this.ripple=new u,this.ripple.init(t,e);for(var o=new cc.Mesh,h=new r.VertexFormat([{name:r.ATTR_POSITION,type:r.ATTR_TYPE_FLOAT32,num:3},{name:r.ATTR_NORMAL,type:r.ATTR_TYPE_FLOAT32,num:3}]),c=(t-1)*(e-1)*2,a=3*c,l=new Array(t*e),p=new Array(c),d=new Array(a),f=new Array(a),m=new Array(a),v=-.5*(t-1)*i,y=-.5*(e-1)*i,N=0;N<c;++N)p[N]=cc.v3(0,1,0);for(var g=0;g<e;++g){var P=g*t;for(N=0;N<t;++N)l[P+N]=cc.v3(N*i+v,0,g*i+y)}this.setVertexAttributes(t,e,d,l);for(var _=0,w=(N=0,d.length);_<w;_+=3,++N)f[_]=p[N],f[_+1]=p[N],f[_+2]=p[N];for(N=0,w=d.length;N<w;++N)m[N]=N;return o.init(h,a,!0),o.setVertices(r.ATTR_POSITION,d),o.setVertices(r.ATTR_NORMAL,f),o.setIndices(m),this.faceNormal=p,this.topology=l,this.mesh=o,this.va=d,this.na=f,o},t.prototype.calcNormals=function(){for(var t=this.va,e=this.faceNormal,i=cc.v3(),r=cc.v3(),n=0,s=0,o=t.length;n<o;n+=3,++s)i.set(t[n+1]).subSelf(t[n]),r.set(t[n+2]).subSelf(t[n]),i.cross(r,e[s])},t.prototype.addForce=function(t,e,i){var r=this.lPtNum,n=this.wPtNum,s=this.uSize,o=cc.v2(e+(r-1)*s*.5,i+(n-1)*s*.5);o.x=Math.round(o.x/s),o.y=Math.round(o.y/s),!0==(o.x>0&&o.x<r&&o.y>0&&o.y<n)&&(this.ripple.vel[o.y*this.lPtNum+o.x]=t)},t.prototype.setHeights=function(t,e){for(var i=this.ripple.hei,r=this.topology,n=0,s=0,o=r.length;s<o;++s)n=i[s],r[s].y=n>t?t:n<e?e:n},t.prototype.setVertexAttributes=function(t,e,i,r){for(var n=0,s=1,o=e-1;s<o;s+=2)for(var h=s*t,c=1,a=t-1;c<a;c+=2){var u=h+c,l=u-t,p=u+t,d=r[u];i[n++]=d,i[n++]=r[l],i[n++]=r[l-1],i[n++]=d,i[n++]=r[l-1],i[n++]=r[u-1],i[n++]=d,i[n++]=r[u-1],i[n++]=r[p-1],i[n++]=d,i[n++]=r[p-1],i[n++]=r[p],i[n++]=d,i[n++]=r[p],i[n++]=r[p+1],i[n++]=d,i[n++]=r[p+1],i[n++]=r[u+1],i[n++]=d,i[n++]=r[u+1],i[n++]=r[l+1],i[n++]=d,i[n++]=r[l+1],i[n++]=r[l]}},t}(),u=function(){function t(){this.hei=null,this.vel=null,this.sizeL=null,this.sizeW=null,this.innerOrder=null}return t.prototype.init=function(t,e){this.hei=new Array(t*e),this.hei.fill(0),this.vel=new Array(t*e),this.vel.fill(0),this.sizeL=t,this.sizeW=e;for(var i=0,r=new Array((t-2)*(e-2)),n=1,s=e-1;n<s;++n)for(var o=1,h=t-1;o<h;++o)r[i++]=n*t+o;this.innerOrder=r},t.prototype.update=function(t){for(var e=this.hei,i=this.vel,r=this.sizeL,n=this.innerOrder,s=1/8/Math.SQRT2,o=0,h=0,c=0,a=0,u=0,l=n.length;u<l;++u)c=(h=n[u])-r,a=h+r,o=e[h]-(1/8*(e[c]+e[a]+e[h-1]+e[h+1])+s*(e[c-1]+e[c+1]+e[a-1]+e[a+1])),i[h]=.987*(i[h]+o);var p=4*t;for(u=0,l=n.length;u<l;++u)e[h=n[u]]-=i[h]*p},t}();cc._RF.pop()},{}]},{},["LowPolyWater"]);