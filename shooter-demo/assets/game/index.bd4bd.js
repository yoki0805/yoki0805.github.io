System.register("chunks:///game.js",["./rollupPluginModLoBabelHelpers-a0dd97cd.js","cc"],(function(){"use strict";var t,e,n,i,o,r,s,a,l,u,c,h,d,p,f,g,m,y,v,b,P,w,S,M,T,B,C,x,R,_,F,N,A,D,I,E,z,L,O,k,W,H,U,G,V,X,q,Z,j,Y,K,J,Q,$,tt,et,nt,it,ot,rt,st,at,lt,ut,ct,ht,dt,pt,ft,gt;return{setters:[function(s){t=s.a,e=s.b,n=s.c,i=s.d,o=s.e,r=s.f},function(t){s=t.cclegacy,a=t.sys,l=t.v4,u=t._decorator,c=t.MeshRenderer,h=t.UIMeshRenderer,d=t.error,p=t.gfx,f=t.clamp,g=t.Component,m=t.geometry,y=t.mat4,v=t.v3,b=t.v2,P=t.UITransform,w=t.PhysicsSystem,S=t.Animation,M=t.math,T=t.tween,B=t.lerp,C=t.UIOpacity,x=t.Node,R=t.find,_=t.Prefab,F=t.quat,N=t.instantiate,A=t.Tween,D=t.CCInteger,I=t.BoxCollider,E=t.Quat,z=t.physics,L=t.Vec3,O=t.AnimationClip,k=t.director,W=t.NodePool,H=t.Label,U=t.game,G=t.input,V=t.Input,X=t.KeyCode,q=t.Camera,Z=t.Game,j=t.AudioSource,Y=t.assetManager,K=t.AudioClip,J=t.Button,Q=t.ParticleSystem2D,$=t.Vec2,tt=t.view,et=t.rect,nt=t.SpriteFrame,it=t.Texture2D,ot=t.size,rt=t.CacheMode,st=t.Director,at=t.Sprite,lt=t.UIRenderer,ut=t.Color,ct=t.screen,ht=t.macro,dt=t.renderer,pt=t.equals,ft=t.BatchingUtility,gt=t.warn}],execute:function(){s._RF.push({},"90dc3pdbUNLk4sJgq6D4PYA","Configurations",void 0);var mt,yt,vt,bt,Pt,wt,St,Mt,Tt,Bt,Ct,xt,Rt,_t,Ft,Nt={scale:1,maxLongSideRate:21/9,maxShortSideRate:9/16},At={isDevTest:!1};!function(){if(!1!==a.isBrowser){var t=window.location.href,e=t.includes("web-mobile"),n=t.includes("github.io");At.isDevTest=e||n}else At.isDevTest=!1}(),s._RF.pop(),s._RF.push({},"78a67/+LbZNJ6UO9Dj7LNsD","MeshCustomColor",void 0);var Dt=l(),It=u.ccclass,Et=u.property,zt=(mt=It("MeshCustomColor"),yt=Et({type:[c],tooltip:"放置所需的 MeshRenderer\n(材質需要打開混合模式)"}),vt=Et({tooltip:"不透明程度: 0 - 255"}),bt=Et({tooltip:"漂色程度: 0 - 1"}),Pt=Et({tooltip:"灰色程度: 0 - 1"}),wt=Et({tooltip:"材質是否勾選 USE INSTANCING (需一致)"}),St=Et({tooltip:"是否運行遊戲後自動設定"}),mt((Bt=t((Tt=function(t){function s(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"meshRenderers",Bt,i(e)),n(e,"_opacity",Ct,i(e)),n(e,"_bleach",xt,i(e)),n(e,"_grayScale",Rt,i(e)),n(e,"useInstancing",_t,i(e)),n(e,"playOnLoad",Ft,i(e)),e.a_custom_color_ctrl=[0,0,0,1],e}e(s,t);var a=s.prototype;return a.onLoad=function(){var t=this;At.isDevTest&&this.useInstancing&&(this.meshRenderers.some((function(t){return!!t.node.getComponent(h)}))&&d("GPU instancing is not supported in 'UI Render Pipeline'."));this.playOnLoad&&this.scheduleOnce((function(){t.opacity=t._opacity,t.bleach=t._bleach}))},a.setOpacity=function(t,e){var n=t.getHandle("mainColor",0,p.Type.FLOAT4);if(0!==n){var i=t.getUniform(n,Dt);i.w=e/255,t.setUniform(n,i)}},a.setBleach=function(t,e){var n=t.getHandle("bleachColor",0,p.Type.FLOAT4);if(0!==n){var i=t.getUniform(n,Dt);i.w=e,t.setUniform(n,i)}},a.setGrayScale=function(t,e){var n=t.getHandle("grayScale",0,p.Type.FLOAT);0!==n&&t.setUniform(n,e)},o(s,[{key:"opacity",get:function(){return this._opacity},set:function(t){var e=this.meshRenderers,n=f(Math.floor(t),0,255);if(this._opacity=n,!0===this.useInstancing){this.a_custom_color_ctrl[0]=(255-n)/255;for(var i,o=r(e);!(i=o()).done;){i.value.setInstancedAttribute("a_custom_color_ctrl",this.a_custom_color_ctrl)}}else for(var s,a=r(e);!(s=a()).done;)for(var l,u=s.value.materials,c=r(u);!(l=c()).done;)for(var h,d=l.value,p=r(d.passes);!(h=p()).done;){var g=h.value;this.setOpacity(g,n)}}},{key:"bleach",get:function(){return this._bleach},set:function(t){var e=this.meshRenderers,n=f(t,0,1);if(this._bleach=n,!0===this.useInstancing){this.a_custom_color_ctrl[1]=n;for(var i,o=r(e);!(i=o()).done;){i.value.setInstancedAttribute("a_custom_color_ctrl",this.a_custom_color_ctrl)}}else for(var s,a=r(e);!(s=a()).done;)for(var l,u=s.value.materials,c=r(u);!(l=c()).done;){var h=l.value;this.setBleach(h.passes[0],this._bleach)}}},{key:"grayScale",get:function(){return this._grayScale},set:function(t){var e=this.meshRenderers,n=f(t,0,1);if(this._grayScale=n,!0===this.useInstancing){this.a_custom_color_ctrl[2]=n;for(var i,o=r(e);!(i=o()).done;){i.value.setInstancedAttribute("a_custom_color_ctrl",this.a_custom_color_ctrl)}}else for(var s,a=r(e);!(s=a()).done;)for(var l,u=s.value.materials,c=r(u);!(l=c()).done;){var h=l.value;this.setGrayScale(h.passes[0],this._grayScale)}}}]),s}(g)).prototype,"meshRenderers",[yt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),t(Tt.prototype,"opacity",[vt],Object.getOwnPropertyDescriptor(Tt.prototype,"opacity"),Tt.prototype),Ct=t(Tt.prototype,"_opacity",[Et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),t(Tt.prototype,"bleach",[bt],Object.getOwnPropertyDescriptor(Tt.prototype,"bleach"),Tt.prototype),xt=t(Tt.prototype,"_bleach",[Et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),t(Tt.prototype,"grayScale",[Pt],Object.getOwnPropertyDescriptor(Tt.prototype,"grayScale"),Tt.prototype),Rt=t(Tt.prototype,"_grayScale",[Et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_t=t(Tt.prototype,"useInstancing",[wt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ft=t(Tt.prototype,"playOnLoad",[St],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mt=Tt))||Mt);s._RF.pop(),s._RF.push({},"37a1bxEw0ZEO6+2ZgrHAXjW","Coordinate",void 0);var Lt=new m.Ray,Ot=(y(),v()),kt=b();function Wt(t,e){var n;return e=null!=(n=e)?n:v(),t.getLocation(kt),e.set(kt.x,kt.y,0)}function Ht(t,e){var n;return e=null!=(n=e)?n:v(),t.getUILocation(kt),e.set(kt.x,kt.y,0)}function Ut(t,e,n,i){var o;i=null!=(o=i)?o:v();var r=t.worldToScreen(n,Ot);return e.screenToWorld(r,i)}function Gt(t,e,n,i){return void 0===e&&(e=""),void 0===n&&(n=null),void 0===i&&(i=null),function(t,e,n,i,o){void 0===n&&(n="");void 0===i&&(i=null);void 0===o&&(o=null);var r=e.play?e:e.getComponent(S),s=null;if(r){""!==n&&null!==n||(n=r.defaultClip?r.defaultClip.name:r.clips[0]?r.clips[0].name:"");var a=S.EventType;switch(r.off(a.FINISHED),t){case 1:r.play(n);break;case 2:r.crossFade(n)}if(null===(s=r.getState(n)))return s;null!==i&&(s.wrapMode=i),o&&r.once(a.FINISHED,(function(){return o()}))}return s}(1,t,e,n,i)}s._RF.pop(),s._RF.push({},"27230InEctLXo9Xsdd2J0R1","AnimationHelper",void 0),s._RF.pop(),s._RF.push({},"a6f03YiUO1CQ6uUzJSusRCA","Utils",void 0);var Vt={};function Xt(t,e){if(t>e){var n=[e,t];t=n[0],e=n[1]}return M.randomRangeInt(t,e+1)}function qt(t){return t[M.randomRangeInt(0,t.length)]}function Zt(t){return t[t.length-1]}function jt(t,e,n){if(t<=e)for(;t<=e;)n(t),++t;else for(;t>=e;)n(t),--t}function Yt(t){if(Math.abs(t%1)<.01){var e=t.toFixed(0);return t>=1e3?e.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):e}var n=t.toFixed(2),i=n.indexOf("."),o=n.slice(0,i),r=n.slice(i);return""+o.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")+r}function Kt(t){return function(e){return Math.pow(e,t)}}function Jt(t,e,n,i,o){var r=ie(t,n);n<0&&(n=r.opacity);var s=o?function(t){return B(n,i,o(t))}:function(t){return B(n,i,t)};return T(t).by(e,Vt,{onUpdate:function(t,e){return r.opacity=s(e)}})}function Qt(t,e){var n=T(t);return n.by(31536e4,Vt,{onUpdate:function(t,i){return e(n)}}).repeatForever().start()}function $t(t,e,n,i){var o=T(t);return o.call((function(){return i(o)})).delay(Math.max(1e-7,e)).union().repeat(Math.max(0,n)).start()}function te(t,e,n){var i=T(t);return i.call((function(){return n(i)})).delay(Math.max(1e-7,e)).union().repeatForever().start()}function ee(t,e,n){var i=T(t);return e>0&&i.delay(e),i.call(n).start()}function ne(t,e,n){var i=t.getComponent(P),o=e<0?i.width:e,r=n<0?i.height:n;return(e>=0||n>=0)&&i.setContentSize(o,r),i}function ie(t,e){var n=t.getComponent(C);return e>=0&&(n.opacity=e),n}function oe(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=e.length;switch(i){case 1:return R(e[0]);case 2:if("string"==typeof e[0])return e[1]instanceof x?R(e[0],e[1]):e[1].node instanceof x?R(e[0],e[1].node):R(e[0]).getComponent(e[1]);var o=e[0]instanceof x?e[0]:e[0].node;return"string"==typeof e[1]?R(e[1],o):o.getComponent(e[1]);case 3:var r=e[0]instanceof x?e[0]:e[0].node,s=R(e[1],r);if(s)return s.getComponent(e[2])}return null}s._RF.pop(),s._RF.push({},"097cfRh8ApDYIK+ymeakAfN","ShootMode",void 0);var re=1,se=2,ae=3;s._RF.pop(),s._RF.push({},"e05f1SqoW9MF57t/gqhf9oN","ShootBetRate",void 0);var le=1,ue=5;s._RF.pop(),s._RF.push({},"4ab23VolpRBAYNG2wIEWN2n","BulletData",void 0),s._RF.pop(),s._RF.push({},"e2a62SR6d5HmLnQy3/smEM0","GameHelper",void 0);var ce,he={props:{empty:{},opacity_0:{opacity:0},opacity_255:{opacity:255},position_0_n100_0:{position:v(0,-100,0)},angle_0_0_n720:{eulerAngles:v(0,0,-720)},angle_0_0_360:{eulerAngles:v(0,0,360)}},opts:{easeOut_2:{easing:(ce=2,function(t){return 1-Math.pow(1-t,ce)})},easeIn_2:{easing:Kt(2)}}},de={props:{positions:[{position:v(0,8,0)},{position:v(0,0,0)},{position:v(0,-8,0)},{position:v(0,0,0)}],angles:[{eulerAngles:v(0,0,2)},{eulerAngles:v(0,0,4)},{eulerAngles:v(0,0,-4)},{eulerAngles:v(0,0,2)}]}};s._RF.pop(),s._RF.push({},"960921PZNZEzbq+iNjH2haU","Game",void 0);var pe,fe,ge,me,ye,ve,be,Pe,we,Se,Me,Te={cam2D:null,cam3D:null,dataMgr:null,gameCtrl:null,monsterMgr:null,shootingMgr:null,effectMgr:null,sndMgr:null,uiCtrl:null,node:{stage:null,display:null,scene:null,ui:null,riverLayer:null,waterLayer:null,landLayer:null,cannonLayer:null,bulletLayer:null,enemyLayer:null,effect3DLayer:null,touchPanel:null,effect2DLayer:null,playerLayer:null,buttonLayer:null,rewardLayer:null,noticeLayer:null,uiLayer:null},_env:new Map,setValue:function(t,e){this._env.set(t,e)},getValue:function(t){var e=this._env.get(t);return void 0===e?null:e}};s._RF.pop(),s._RF.push({},"5f5e4xMk1JGqZfKsiLzgu6G","AxeBullet",void 0);var Be=900,Ce=10,xe=v(),Re=v(),_e=u.ccclass,Fe=u.property,Ne=(pe=_e("AxeBullet"),fe=Fe({type:x,tooltip:"飛斧的移動節點"}),ge=Fe({type:x,tooltip:"飛斧的旋轉節點"}),me=Fe({type:x,tooltip:"飛斧的光效節點"}),ye=Fe({type:_,tooltip:"受擊效果"}),pe((Pe=t((be=function(t){function r(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"moveNode",Pe,i(e)),n(e,"rotNode",we,i(e)),n(e,"lightNode",Se,i(e)),n(e,"hitFxPrefab",Me,i(e)),e.bltData={type:0,id:0,bet:0,cost:0,using:!1},e.hitFxNode=null,e.reuseFunc=null,e.axeHandSide=0,e.axeInitRot=F(),e.lifetime=0,e.speed=0,e.isHit=!1,e.isCosted=!1,e.isFlying=!1,e.hitTarget=null,e.aimTarget=null,e.aimBulletPos=v(),e.targetStartPos=v(),e.targetOffset=v(),e.bltStartPos=v(),e.hitWpos2D=v(),e}e(r,t);var s=r.prototype;return s.onLoad=function(){this.rotNode.getRotation(this.axeInitRot)},s.onDestroy=function(){var t;null==(t=this.hitFxNode)||t.destroy(),this.hitFxNode=null,this.reuseFunc=null,this.clearBulletAction()},s.update=function(t){this.isUsing()&&(this.lifetime-=t,this.lifetime<=0?this.onMiss():this.updatePosition(t))},s.init=function(t,e,n,i,o,r,s){void 0===s&&(s=null);var a=this.bltData;a.type=ae,a.id=e,a.bet=n,a.cost=i,a.using=!0,this.node.setWorldPosition(t),this.reuseFunc=s,this.isFlying=!1,this.isCosted=!1,this.isHit=!1;var l=Te.monsterMgr.getEntityByID(o);return l&&l.isUsing()?(this.axeHandSide=r,this.aimTarget=l,this.setup(),this.isFlying=!0,this.isCosted=!0,!0):(this.destroyBullet(),!1)},s.setup=function(){this.speed=Be,this.lifetime=Ce,this.bltStartPos.set(this.node.position),this.targetStartPos.set(this.aimTarget.node.position),this.targetOffset.set(0,0,0),this.moveNode.setPosition(0,0,0),this.lightNode.active=!0,this.setAiming(),this.setTrackFx()},s.setAiming=function(){var t=this,e=this.node,n=this.axeHandSide,i=0===n?-30:30,o=M.randomRange(25,35)*(0===n?1:-1);e.setRotationFromEuler(0,0,o);var r=this.moveNode,s=r.position,a=Te.shootingMgr.getAimingWorldPos(this.aimTarget,Re),l=r.parent.inverseTransformPoint(xe,a),u=Re.set(l).subtract(s);u.x+=i,u.y=0;var c=u.length(),h=Math.max(.5,c/this.speed),d=h/2,p=Math.min(350,Math.max(c/4,l.y+25)),f=s.y+p,g=l.y,m=r.getPosition(this.aimBulletPos);T(m).to(d,{y:f},he.opts.easeOut_2).to(d,{y:g},he.opts.easeIn_2).start(),T(m).by(h,{x:u.x,z:u.z}).call((function(){var e=t.aimTarget;e&&e.isUsing()?(t.hitTarget=e,t.onHit()):t.onMiss()})).start(),this.rotNode.setRotation(this.axeInitRot),T(this.rotNode).by(h,he.props.angle_0_0_n720).repeatForever().start()},s.setTrackFx=function(){var t=this;T(this.rotNode).delay(.1).call((function(){var e=Te.dataMgr.getAxeBulletTrackFxNode();e.setParent(Te.node.effect3DLayer),e.setWorldPosition(t.moveNode.worldPosition),e.setRotation(t.node.worldRotation),Gt(e,"",null,(function(){Te.dataMgr.putToAxeBulletTrackFxPool(e)}))})).union().repeatForever().start()},s.onHit=function(){var t=this;this.isHit=!0,this.updateHitWpos2D(),this.makeFakeAxeOnHit();var e=Math.floor(ue);this.hitTarget.showHurt(e),Te.monsterMgr.entityOnHit(this.hitTarget,this.bltData),this.playHitFx((function(){return t.destroyBullet()})),this.node.setPosition(0,-1e6,0),this.clearBulletAction()},s.onMiss=function(){var t=this;if(this.isHit=!1,this.updateHitWpos2D(),this.isCosted){var e=this.bltData;Te.effectMgr.showMissText(this.hitWpos2D),Te.shootingMgr.cancelShoot(e.type,e.id,e.bet,e.cost),this.isCosted=!1}this.playHitFx((function(){return t.destroyBullet()})),this.node.setPosition(0,-1e6,0),this.clearBulletAction()},s.updateHitWpos2D=function(){Ut(Te.cam3D,Te.cam2D,this.moveNode.worldPosition,this.hitWpos2D)},s.playHitFx=function(t){var e,n=this,i=null!=(e=this.hitFxNode)?e:N(this.hitFxPrefab);i.setParent(Te.node.effect2DLayer),this.hitFxNode=i,i.setWorldPosition(this.hitWpos2D),i.angle=this.node.eulerAngles.z,Gt(i,"",null,(function(){n.hitFxNode.removeFromParent(),t()}))},s.makeFakeAxeOnHit=function(){var t=this.hitTarget;if(t&&t.isUsing()){var e=this.node,n=this.rotNode,i=Te.dataMgr.getAxeModelNode(),o=i.getComponent(zt);i.setParent(t.node),i.setWorldPosition(n.worldPosition),i.setWorldRotation(e.worldRotation),ee(i,.55,(function(){T(o).to(.25,he.props.opacity_0,he.opts.easeIn_2).call((function(){o.opacity=255,A.stopAllByTarget(o),Te.dataMgr.putToAxeModelPool(i)})).start()}))}},s.clearBulletAction=function(){this.isFlying&&(A.stopAllByTarget(this.rotNode),A.stopAllByTarget(this.aimBulletPos),this.moveNode.setPosition(0,0,0),this.aimTarget=null,this.hitTarget=null,this.isFlying=!1,this.lifetime=0,this.setUsing(!1))},s.destroyBullet=function(){this.clearBulletAction(),this.reuseFunc?(this.reuseFunc(),this.reuseFunc=null):this.node.destroy()},s.updatePosition=function(t){var e=this.aimTarget;if(e&&e.isUsing()){var n=e.node.position;this.targetOffset.set(n).subtract(this.targetStartPos),this.targetOffset.add3f(0,30,70)}var i=Re.set(this.bltStartPos).add(this.targetOffset);this.moveNode.setPosition(this.aimBulletPos),this.node.setPosition(i)},s.setUsing=function(t){this.bltData.using=t},s.isUsing=function(){return this.bltData.using},o(r,[{key:"data",get:function(){return this.bltData}}]),r}(g)).prototype,"moveNode",[fe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),we=t(be.prototype,"rotNode",[ge],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Se=t(be.prototype,"lightNode",[me],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Me=t(be.prototype,"hitFxPrefab",[ye],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ve=be))||ve);function Ae(t,e){return t.delay(e)}function De(t,e){return t.set({position:v(e)})}function Ie(t,e,n){return t.to(e,{position:v(n)})}s._RF.pop(),s._RF.push({},"dc3f5r07t9HarOzCXBrn5If","PathData",void 0);var Ee=new Map;var ze=T();Ae(ze,0),De(ze,v(810,0,-280)),Ie(ze,20,v(-810,0,-280)),Ee.set(1,ze);var Le=T();Ae(Le,0),De(Le,v(-810,0,150)),Ie(Le,20,v(810,0,150)),Ee.set(2,Le);var Oe=T();Ae(Oe,0),De(Oe,v(-810,0,-320)),Ie(Oe,6,v(-300,0,-320)),Ie(Oe,5,v(-300,0,280)),Ie(Oe,6,v(-810,0,280)),Ee.set(3,Oe);var ke=T();Ae(ke,0),De(ke,v(810,0,-320)),Ie(ke,6,v(300,0,-320)),Ie(ke,5,v(300,0,280)),Ie(ke,6,v(810,0,280)),Ee.set(4,ke);var We=T();Ae(We,0),De(We,v(-810,0,160)),Ie(We,4,v(-480,0,160)),Ie(We,3,v(-480,0,-180)),Ie(We,4,v(-810,0,-180)),Ee.set(5,We);var He=T();Ae(He,0),De(He,v(810,0,160)),Ie(He,4,v(480,0,160)),Ie(He,3,v(480,0,-180)),Ie(He,4,v(810,0,-180)),Ee.set(6,He);var Ue,Ge,Ve,Xe,qe,Ze,je,Ye,Ke,Je,Qe,$e,tn,en,nn,on,rn,sn=T();Ae(sn,0),De(sn,v(0,0,-120)),Ie(sn,65,v(0,0,-120)),Ee.set(101,sn),s._RF.pop(),s._RF.push({},"813f2p4eGZMepzko/SGpeYR","Monster",void 0);var an,ln,un,cn,hn,dn,pn,fn=u.ccclass,gn=u.property,mn=(Ue=fn("Monster"),Ge=gn([D]),Ve=gn([S]),Xe=gn([x]),qe=gn([I]),Ze=gn({tooltip:"是否為一般怪物"}),je=gn({tooltip:"是否為特殊怪物"}),Ye=gn({tooltip:"是否為 Boss 怪物"}),Ue((Qe=t((Je=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"oddsList",Qe,i(e)),n(e,"monsterAnims",$e,i(e)),n(e,"aimNodes",tn,i(e)),n(e,"colliders",en,i(e)),n(e,"isNormalMonster",nn,i(e)),n(e,"isSpecialMonster",on,i(e)),n(e,"isBossMonster",rn,i(e)),e.meshCustomColor=null,e.damagetween=null,e.tintBase=0,e.no=0,e.id=0,e.oddsIndex=0,e.using=!1,e.defaultScale=v(1,1,1),e.moveTween=null,e.moveEnd=!1,e.reuse=!0,e}e(o,t);var r=o.prototype;return r.onLoad=function(){this.meshCustomColor=this.node.getComponent(zt),this.defaultScale.set(this.node.scale)},r.onDestroy=function(){A.stopAllByTarget(this.node),this.stopDamageTint(),this.stopMove()},r.init=function(t,e){this.no=t,this.id=e,this.colliders.forEach((function(t){t.enabled=!0})),this.using=!0,this.reuse=!0,this.moveEnd=!1;var n=this.node;n.setScale(this.defaultScale),n.setRotation(E.IDENTITY),n.setPosition(0,-5e3,0)},r.setMovePath=function(t){var e=this;this.moveTween&&this.stopMove();var n=function(t,e){var n=Ee.get(t);return n?n.clone(e):null}(t,this.node);return n?(this.moveEnd=!1,this.moveTween=n.call((function(){e.scheduleOnce((function(){return e.pushToPool()})),e.moveTween=null,e.moveEnd=!0})).start(),!0):(this.moveEnd=!0,!1)},r.stopMove=function(){var t;null==(t=this.moveTween)||t.stop(),this.moveTween=null,this.moveEnd=!0},r.pushToPool=function(){A.stopAllByTarget(this.node),this.damageTint(!1),this.setGrayScale(0),this.stopMove(),this.using=!1,this.node.setScale(this.defaultScale),Te.monsterMgr.removeFromEntitiesMap(this.id),this.reuse?Te.dataMgr.putToMonsterPool(this.node,this.no):this.node.destroy()},r.setGrayScale=function(t){var e=this.meshCustomColor;e&&(e.grayScale=t)},r.damageTint=function(t,e){var n=this;void 0===e&&(e=.25);var i=this.meshCustomColor;if(i)if(t){if(t&&!this.damagetween){i.bleach=this.tintBase,this.damagetween=T(i).to(e,{bleach:.67},he.opts.easeOut_2).call((function(){i.bleach=n.tintBase,n.damagetween=null})).start()}}else i.bleach=this.tintBase,this.stopDamageTint()},r.stopDamageTint=function(){var t;null==(t=this.damagetween)||t.stop(),this.damagetween=null},r.getDefaultScale=function(){return this.defaultScale},r.getOdds=function(){return this.oddsList[this.oddsIndex]},r.getNo=function(){return this.no},r.getID=function(){return this.id},r.isMoveEnd=function(){return this.moveEnd},r.setUsing=function(t){this.using=t},r.isUsing=function(){return this.using},r.setReuse=function(t){this.reuse=t},r.isReuse=function(){return this.reuse},r.postInit=function(){},r.showHurt=function(t){},r.showReward=function(t){return!1},r.showDeath=function(){},r.getHurtSndName=function(){return""},o}(g)).prototype,"oddsList",[Ge],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$e=t(Je.prototype,"monsterAnims",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tn=t(Je.prototype,"aimNodes",[Xe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),en=t(Je.prototype,"colliders",[qe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),nn=t(Je.prototype,"isNormalMonster",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),on=t(Je.prototype,"isSpecialMonster",[je],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),rn=t(Je.prototype,"isBossMonster",[Ye],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ke=Je))||Ke);s._RF.pop(),s._RF.push({},"92466bMH11EPrIe1fnWyAUU","NormalBullet",void 0);var yn,vn,bn,Pn,wn,Sn,Mn,Tn,Bn,Cn,xn,Rn=1100,_n=800,Fn=10,Nn=v(),An=v(),Dn=F(),In=u.ccclass,En=u.property,zn=(an=In("NormalBullet"),ln=En({type:x,tooltip:"子彈的旋轉節點"}),un=En({type:_,tooltip:"受擊效果"}),an((dn=t((hn=function(t){function r(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"rotNode",dn,i(e)),n(e,"hitFxPrefab",pn,i(e)),e.bltData={type:0,id:0,bet:0,cost:0,using:!1},e.collider=null,e.hitFxNode=null,e.reuseFunc=null,e.lifetime=0,e.speed=0,e.dir=v(),e.vel=v(),e.isHit=!1,e.isAiming=!1,e.isCosted=!1,e.isFlying=!1,e.hitTarget=null,e.aimTarget=null,e.aimBulletPos=v(),e.targetStartPos=v(),e.targetOffset=v(),e.hitWpos2D=v(),e}e(r,t);var s=r.prototype;return s.onLoad=function(){this.collider=this.getComponent(I),this.collider.on("onTriggerEnter",this.onTriggerEnter,this)},s.onDestroy=function(){var t;this.collider.off("onTriggerEnter",this.onTriggerEnter,this),null==(t=this.hitFxNode)||t.destroy(),this.hitFxNode=null,this.reuseFunc=null,this.clearBulletAction()},s.update=function(t){this.isUsing()&&(this.lifetime-=t,this.lifetime<=0?this.onMiss():this.updatePosition(t))},s.init=function(t,e,n,i,o,r){void 0===r&&(r=null);var s=this.bltData;if(s.type=re,s.id=e,s.bet=n,s.cost=i,s.using=!0,this.node.setWorldPosition(t),this.reuseFunc=r,this.isAiming=!1,this.isFlying=!1,this.isCosted=!1,this.isHit=!1,-1!==o){var a=Te.monsterMgr.getEntityByID(o);if(!a||!a.isUsing())return this.destroyBullet(),!1;s.type=se,this.aimTarget=a,this.isAiming=!0}return this.setup(),this.isFlying=!0,this.isCosted=!0,!0},s.setup=function(){this.isAiming?(this.speed=_n,this.lifetime=Fn,this.targetStartPos.set(this.aimTarget.node.position),this.targetOffset.set(0,0,0),this.setAiming()):(this.speed=Rn,this.lifetime=Fn,this.dir.set(0,0,-1),this.vel.set(this.dir).multiplyScalar(this.speed)),this.alignDirection(),T(this.rotNode).by(.6,he.props.angle_0_0_360).repeatForever().start()},s.setAiming=function(){var t=this,e=this.node,n=e.position,i=Te.shootingMgr.getAimingWorldPos(this.aimTarget,An),o=e.parent.inverseTransformPoint(Nn,i),r=An.set(o).subtract(n);r.y=0;var s=r.length(),a=Math.max(.5,s/this.speed)/2,l=Math.min(350,Math.max(s/4,o.y+25)),u=n.y+l,c=o.y,h=e.getPosition(this.aimBulletPos);h.add3f(.001*r.x,.002*l,.001*r.z),this.dir.set(h).subtract(n).normalize(),this.vel.set(this.dir).multiplyScalar(this.speed),T(h).to(a,{y:u},he.opts.easeOut_2).to(a,{y:c},he.opts.easeIn_2).start(),T(h).by(2*a,{x:r.x,z:r.z}).call((function(){var e=t.aimTarget;e&&e.isUsing()?(t.hitTarget=e,t.onHit()):t.onMiss()})).start()},s.onTriggerEnter=function(t){if(!this.isAiming){var e=t.otherCollider,n=z.PhysicsGroup,i=e.node,o=e.getGroup();o===n.MONSTER?this.entityOnHit(i):o===n.WALL&&this.wallOnHit(i)}},s.entityOnHit=function(t){var e=t.getComponent(mn);e&&e.isUsing()?(this.hitTarget=e,this.onHit()):this.onMiss()},s.wallOnHit=function(t){var e=Math.abs,n=this.dir,i=this.vel;switch(t.name){case"Top":n.z=e(n.z),i.z=e(i.z);break;case"Down":n.z=-e(n.z),i.z=-e(i.z);break;case"Left":n.x=e(n.x),i.x=e(i.x);break;case"Right":n.x=-e(n.x),i.x=-e(i.x)}this.alignDirection()},s.onHit=function(){var t=this;this.isHit=!0,this.updateHitWpos2D();var e=Math.floor(le);this.hitTarget.showHurt(e),Te.monsterMgr.entityOnHit(this.hitTarget,this.bltData),this.playHitFx((function(){return t.destroyBullet()})),this.node.setPosition(0,-1e6,0),this.clearBulletAction()},s.onMiss=function(){var t=this;if(this.isHit=!1,this.updateHitWpos2D(),this.isCosted){var e=this.bltData;Te.effectMgr.showMissText(this.hitWpos2D),Te.shootingMgr.cancelShoot(e.type,e.id,e.bet,e.cost),this.isCosted=!1}this.playHitFx((function(){return t.destroyBullet()})),this.node.setPosition(0,-1e6,0),this.clearBulletAction()},s.updateHitWpos2D=function(){Ut(Te.cam3D,Te.cam2D,this.node.worldPosition,this.hitWpos2D)},s.playHitFx=function(t){var e,n=this,i=null!=(e=this.hitFxNode)?e:N(this.hitFxPrefab);i.setParent(Te.node.effect2DLayer),this.hitFxNode=i,i.setWorldPosition(this.hitWpos2D),i.angle=M.randomRange(0,360),Gt(i,"",null,(function(){n.hitFxNode.removeFromParent(),t()}))},s.clearBulletAction=function(){this.isFlying&&(A.stopAllByTarget(this.rotNode),A.stopAllByTarget(this.aimBulletPos),this.aimTarget=null,this.hitTarget=null,this.isFlying=!1,this.lifetime=0,this.setUsing(!1))},s.destroyBullet=function(){this.clearBulletAction(),this.reuseFunc?(this.reuseFunc(),this.reuseFunc=null):this.node.destroy()},s.updatePosition=function(t){var e=this.node;if(this.isAiming){var n=this.aimTarget;if(n&&n.isUsing()){var i=n.node.position;this.targetOffset.set(i).subtract(this.targetStartPos)}var o=An.set(this.aimBulletPos).add(this.targetOffset);this.dir.set(o).subtract(e.position).normalize(),this.vel.set(this.dir).multiplyScalar(this.speed),e.setPosition(o),this.alignDirection()}else{var r=this.vel,s=e.position;e.setPosition(s.x+r.x*t,s.y,s.z+r.z*t)}},s.alignDirection=function(){var t=E.rotationTo(Dn,L.FORWARD,this.dir);this.node.setRotation(t)},s.setUsing=function(t){this.bltData.using=t},s.isUsing=function(){return this.bltData.using},o(r,[{key:"data",get:function(){return this.bltData}}]),r}(g)).prototype,"rotNode",[ln],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pn=t(hn.prototype,"hitFxPrefab",[un],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cn=hn))||cn);s._RF.pop(),s._RF.push({},"75845Qj1nxMHYpvZ/2u5uyd","ShootRecord",void 0),s._RF.pop(),s._RF.push({},"c6efbo2rYhG8ZzR8riyIheD","RoleCannon",void 0);var Ln,On=u.ccclass,kn=u.property,Wn=(yn=On("RoleCannon"),vn=kn(x),bn=kn([x]),Pn=kn(_),wn=kn(_),yn((Tn=t((Mn=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"normalCannonPivot",Tn,i(e)),n(e,"axeThrowPivots",Bn,i(e)),n(e,"normalCannonPrefab",Cn,i(e)),n(e,"changeFxPrefab",xn,i(e)),e.roleNode=null,e.cannonNode=null,e.cannonTapOnNode=null,e.cannonGunFireNode=null,e.axeHandSide=0,e}e(o,t);var r=o.prototype;return r.onLoad=function(){this.roleNode=oe(this.node,"RootNode"),this.cannonNode=N(this.normalCannonPrefab),this.cannonTapOnNode=this.cannonNode.getChildByName("TapOn"),this.cannonGunFireNode=this.cannonNode.getChildByName("GunFire"),this.cannonNode.setParent(this.normalCannonPivot),this.axeHandSide=Xt(0,1)},r.equip=function(){this.playIdle(),this.playChangeFx()},r.tryToShoot=function(t,e,n){var i=Te.dataMgr,o=Te.shootingMgr,r=null!=n?n:{bltID:0,bltBet:0,bltCost:0,aimingID:0,shootMode:0,isShot:!1},s=o.shootMode;switch(r.bltID=0,r.bltBet=t,r.bltCost=e,r.aimingID=o.getAimingID(),r.shootMode=s,r.isShot=!1,s){case re:case se:var a=i.getNormalBulletNode(),l=a.getComponent(zn),u=this.getMuzzleWorldPos();a.setParent(Te.node.bulletLayer),r.isShot=l.init(u,o.peekNextBulletID(),t,e,r.aimingID,(function(){i.putToNormalBulletPool(a)}));break;case ae:var c=i.getAxeBulletNode(),h=c.getComponent(Ne),d=this.getMuzzleWorldPos();c.setParent(Te.node.bulletLayer),r.isShot=h.init(d,o.peekNextBulletID(),t,e,r.aimingID,this.axeHandSide,(function(){i.putToAxeBulletPool(c)}))}return r.isShot&&(r.bltID=o.newBulletID(),this.playShoot()),r},r.getMuzzleWorldPos=function(){switch(Te.shootingMgr.shootMode){case re:case se:return this.cannonNode.children[0].children[0].worldPosition;case ae:return this.axeThrowPivots[this.axeHandSide].worldPosition}},r.getShootWorldPosX=function(){switch(Te.shootingMgr.shootMode){case re:case se:return this.getMuzzleWorldPos().x;case ae:return this.node.parent.worldPosition.x}},r.isNeedTarget=function(){var t=Te.shootingMgr.shootMode;return t!==re&&(t===se||(t===ae||void 0))},r.getShootingCost=function(){var t=Te.gameCtrl.getPlayerBet(),e=Te.shootingMgr.shootMode;return e===re||e===se?t*le:e===ae?t*ue:void 0},r.getCoolDownTime=function(){var t=Te.shootingMgr.shootMode;return t===re||t===se?.2:t===ae?.25:void 0},r.playIdle=function(){switch(Te.shootingMgr.shootMode){case re:Gt(this.node,"Cannon_Idle"),Gt(this.roleNode,"Cannon_Idle");break;case se:Gt(this.node,"Aim_Idle"),Gt(this.roleNode,"Aim_Idle");break;case ae:Gt(this.node,"Axe_Idle"),Gt(this.roleNode,"Axe_Idle")}},r.playShoot=function(){var t=this,e=O.WrapMode.Normal;switch(Te.shootingMgr.shootMode){case re:Gt(this.node,"Cannon_Attack"),Gt(this.roleNode,"Cannon_Attack",e,(function(){return t.playIdle()})),Gt(this.cannonNode,"",e),Gt(this.cannonGunFireNode),Gt(this.cannonTapOnNode),Te.sndMgr.playOneShot("Shoot_Normal");break;case se:Gt(this.node,"Aim_Attack"),Gt(this.roleNode,"Aim_Attack",e,(function(){return t.playIdle()})),Gt(this.cannonNode,"",e),Gt(this.cannonGunFireNode),Gt(this.cannonTapOnNode),Te.sndMgr.playOneShot("Shoot_Normal");break;case ae:var n=0===this.axeHandSide?"Axe_Attack_L":"Axe_Attack_R";Gt(this.node,n),Gt(this.roleNode,n,e,(function(){return t.playIdle()})),Te.sndMgr.playOneShot("Shoot_Axe"),this.axeHandSide^=1}},r.playChangeFx=function(){var t=Ut(Te.cam3D,Te.cam2D,this.node.worldPosition);t.y+=50;var e=N(this.changeFxPrefab);e.setParent(Te.node.effect2DLayer),e.setWorldPosition(t),Gt(e,"",null,(function(){e.destroy()}))},o}(g)).prototype,"normalCannonPivot",[vn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Bn=t(Mn.prototype,"axeThrowPivots",[bn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Cn=t(Mn.prototype,"normalCannonPrefab",[Pn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xn=t(Mn.prototype,"changeFxPrefab",[wn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Sn=Mn))||Sn);s._RF.pop(),s._RF.push({},"1ffc26Wtj9PULuC9ZYwWo8L","RoleTurret",void 0);var Hn,Un,Gn,Vn,Xn,qn,Zn,jn,Yn,Kn,Jn,Qn,$n,ti,ei,ni,ii,oi,ri,si,ai,li,ui,ci,hi,di,pi,fi,gi,mi=u.ccclass,yi=(u.property,mi("RoleTurret")(Ln=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this).cannon=null,e.locked=!1,e}e(n,t);var i=n.prototype;return i.onLoad=function(){this.addCannon()},i.addCannon=function(){var t=this,e=Te.node.cannonLayer.children[0],n=Te.dataMgr.getQueenCannonNode();this.cannon=n.getComponent(Wn),n.setRotationFromEuler(0,180,0),n.setParent(e),Qt(this.node,(function(e){Te.gameCtrl.isReadyToPlay()&&(t.cannon.equip(),e.stop())}))},i.moveToWorldPosX=function(t){var e=this.cannon.node.parent,n=e.worldPosition;e.setWorldPosition(t,n.y,n.z),this.showLocationHint(!1)},i.getWorldPos=function(){return this.cannon.node.parent.worldPosition},i.isLocked=function(){return this.locked},i.setLock=function(t){this.locked=t},i.showLocationHint=function(t){var e=Te.uiCtrl.locationHintNode;if(e.active=t,t){var n=e.worldPosition,i=Ut(Te.cam3D,Te.cam2D,this.getWorldPos());e.setWorldPosition(i.x,n.y,n.z)}},n}(g))||Ln);s._RF.pop(),s._RF.push({},"98a8ceZmqJH7rt2sZa1J+Uo","PropertyRes",void 0);var vi,bi=u.ccclass,Pi=u.property,wi=(Hn=bi("PropertyRes"),Un=Pi({type:_,tooltip:"玩家炮台的 Prefab"}),Gn=Pi({type:_,tooltip:"一般子彈的 Prefab"}),Vn=Pi({type:_,tooltip:"飛斧子彈的 Prefab"}),Xn=Pi({type:_,tooltip:"飛斧子彈軌跡的 Prefab"}),qn=Pi({type:_,tooltip:"飛斧模型的 Prefab"}),Zn=Pi({type:_,tooltip:"小金幣的 Prefab"}),jn=Pi({type:_,tooltip:"Boss 金幣的 Prefab"}),Yn=Pi({type:_,tooltip:"獲獎金額數字的 Prefab"}),Kn=Pi({type:_,tooltip:"未命中文字的 Prefab"}),Jn=Pi({type:_,tooltip:"Boss 來襲的 Prefab"}),Qn=Pi({type:_,tooltip:"水波的 Prefab"}),$n=Pi({type:_,tooltip:"水花的 Prefab"}),ti=Pi({type:[_],tooltip:"怪物的 Prefab"}),Hn((ii=t((ni=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"queenCannonPrefab",ii,i(e)),n(e,"normalBulletPrefab",oi,i(e)),n(e,"axeBulletPrefab",ri,i(e)),n(e,"axeBulletTrackFxPrefab",si,i(e)),n(e,"axeModelPrefab",ai,i(e)),n(e,"smallCoinPrefab",li,i(e)),n(e,"bossCoinPrefab",ui,i(e)),n(e,"winNumPrefab",ci,i(e)),n(e,"missTextPrefab",hi,i(e)),n(e,"bossComingPrefab",di,i(e)),n(e,"waterRipplePrefab",pi,i(e)),n(e,"waterSplashPrefab",fi,i(e)),n(e,"monsterPrefabs",gi,i(e)),e}return e(o,t),o}(g)).prototype,"queenCannonPrefab",[Un],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oi=t(ni.prototype,"normalBulletPrefab",[Gn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ri=t(ni.prototype,"axeBulletPrefab",[Vn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),si=t(ni.prototype,"axeBulletTrackFxPrefab",[Xn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ai=t(ni.prototype,"axeModelPrefab",[qn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),li=t(ni.prototype,"smallCoinPrefab",[Zn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ui=t(ni.prototype,"bossCoinPrefab",[jn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ci=t(ni.prototype,"winNumPrefab",[Yn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),hi=t(ni.prototype,"missTextPrefab",[Kn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),di=t(ni.prototype,"bossComingPrefab",[Jn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pi=t(ni.prototype,"waterRipplePrefab",[Qn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fi=t(ni.prototype,"waterSplashPrefab",[$n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gi=t(ni.prototype,"monsterPrefabs",[ti],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ei=ni))||ei);s._RF.pop(),s._RF.push({},"1a13aE5xjZMs4t9B/A6DFt0","DataMgr",void 0);var Si,Mi=u.ccclass;u.property,Mi("DataMgr")(vi=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this)._res=null,e.normalBltPool=new W,e.axeBltPool=new W,e.axeBltTrackFxPool=new W,e.axeModelPool=new W,e.smallCoinPool=new W,e.bossCoinPool=new W,e.winNumPool=new W,e.missTextPool=new W,e.waterRipplePool=new W,e.waterSplashPool=new W,e.monsterPoolMap=new Map,e}e(n,t);var i=n.prototype;return i.onLoad=function(){Te.dataMgr=this,this.freeOnStageDestroy((function(){return Te.dataMgr=null})),this._res=this.getComponentInChildren(wi)},i.onDestroy=function(){this.clearAllPools()},i.freeOnStageDestroy=function(t){k.once("__Free__",t)},i.clearAllPools=function(){this.normalBltPool.clear(),this.axeBltPool.clear(),this.axeBltTrackFxPool.clear(),this.axeModelPool.clear(),this.smallCoinPool.clear(),this.bossCoinPool.clear(),this.winNumPool.clear(),this.missTextPool.clear(),this.waterRipplePool.clear(),this.waterSplashPool.clear(),this.monsterPoolMap.forEach((function(t){return t.clear()})),this.monsterPoolMap.clear()},i.getQueenCannonNode=function(){return N(this._res.queenCannonPrefab)},i.getNormalBulletNode=function(){var t;return null!=(t=this.normalBltPool.get())?t:N(this._res.normalBulletPrefab)},i.putToNormalBulletPool=function(t){this.normalBltPool.put(t)},i.getAxeBulletNode=function(){var t;return null!=(t=this.axeBltPool.get())?t:N(this._res.axeBulletPrefab)},i.putToAxeBulletPool=function(t){this.axeBltPool.put(t)},i.getAxeBulletTrackFxNode=function(){var t;return null!=(t=this.axeBltTrackFxPool.get())?t:N(this._res.axeBulletTrackFxPrefab)},i.putToAxeBulletTrackFxPool=function(t){this.axeBltTrackFxPool.put(t)},i.getAxeModelNode=function(){var t;return null!=(t=this.axeModelPool.get())?t:N(this._res.axeModelPrefab)},i.putToAxeModelPool=function(t){this.axeModelPool.put(t)},i.getSmallCoinNode=function(){var t;return null!=(t=this.smallCoinPool.get())?t:N(this._res.smallCoinPrefab)},i.putToSmallCoinPool=function(t){this.smallCoinPool.put(t)},i.getBossCoinNode=function(){var t;return null!=(t=this.bossCoinPool.get())?t:N(this._res.bossCoinPrefab)},i.putToBossCoinPool=function(t){this.bossCoinPool.put(t)},i.getWinNumNode=function(){var t;return null!=(t=this.winNumPool.get())?t:N(this._res.winNumPrefab)},i.putToWinNumPool=function(t){this.winNumPool.put(t)},i.getMissTextNode=function(){var t;return null!=(t=this.missTextPool.get())?t:N(this._res.missTextPrefab)},i.putToMissTextPool=function(t){this.missTextPool.put(t)},i.getWaterRippleNode=function(){var t;return null!=(t=this.waterRipplePool.get())?t:N(this._res.waterRipplePrefab)},i.putToWaterRipplePool=function(t){this.waterRipplePool.put(t)},i.getWaterSplashNode=function(){var t;return null!=(t=this.waterSplashPool.get())?t:N(this._res.waterSplashPrefab)},i.putToWaterSplashPool=function(t){this.waterSplashPool.put(t)},i.getMonsterNode=function(t){var e,n=this._res.monsterPrefabs;if(t<=0||t>=n.length)return null;var i=this.monsterPoolMap,o=i.get(t);return o||(o=new W,i.set(t,o)),null!=(e=o.get())?e:N(n[t])},i.putToMonsterPool=function(t,e){var n=this.monsterPoolMap.get(e);n?n.put(t):t.destroy()},o(n,[{key:"res",get:function(){return this._res}}]),n}(g));s._RF.pop(),s._RF.push({},"f7368jQW95DXJ73KtTLgq69","EffectMgr",void 0);var Ti,Bi=O.WrapMode,Ci=v(),xi=u.ccclass;u.property,xi("EffectMgr")(Si=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var i=n.prototype;return i.onLoad=function(){Te.effectMgr=this,Te.dataMgr.freeOnStageDestroy((function(){return Te.effectMgr=null}))},i.showBossComing=function(t,e){var n=N(Te.dataMgr.res.bossComingPrefab);n.setParent(Te.node.noticeLayer),oe(n,"Node_1/bar/OddsNum",H).string=Yt(t),Te.sndMgr.playOneShot("Boss_Coming"),Gt(n,"",null,(function(){n.destroy(),null==e||e()}))},i.showGetCoins=function(t,e,n,i){for(var o=Te.dataMgr,r=Te.node.effect3DLayer,s=M.randomRange,a=function(t){return function(e){var n=2*e;return n<1?.5*Math.pow(n,t):1-.5*Math.pow(2-n,t)}}(2),l=he.opts.easeIn_2,u=he.opts.easeOut_2,c={position:v(0,0,0)},h={position:v(0,20,0)},d=L.distance(t,e)/1500,p=Xt(4,7),f=function(n){var f=o.getSmallCoinNode();f.setParent(r),f.setWorldPosition(t.x+s(-50,50),t.y,t.z+s(-50,50));var g=f.children[0];g.setPosition(0,-1e3,0);var m=s(200,320),y=s(70,120);T(g).delay(s(0,.3)).set(c).to(.01*s(25,40),{position:v(0,m,0)},u).to(.01*s(20,30),c,l).to(.01*s(20,30),{position:v(0,y,0)},u).to(.01*s(20,30),c,l).to(.1,h,u).to(.1,c,l).start();var b=n===p,P=v(f.worldPosition),w=e;T(f).delay(2).by(d,he.props.empty,{onUpdate:function(t,e){var n=a(e);g.setWorldPosition(B(P.x,w.x,n),B(P.y,w.y,n),B(P.z,w.z,n))}}).call((function(){if(g.setPosition(0,0,0),A.stopAllByTarget(g),o.putToSmallCoinPool(f),b){var t=Math.min(5,Xt(1,p));$t(Te.gameCtrl.timer,.08,t,(function(){Te.sndMgr.playOneShot("Collect_01")})),null==i||i()}})).start()},g=1;g<=p;++g)f(g);if(n>0){var m=Ut(Te.cam3D,Te.cam2D,t,Ci);m.x+=40,m.y-=40,this.showWinNum(m,n)}},i.showBossGetCoins=function(t,e,n){var i=Te.dataMgr,o=Te.node.effect2DLayer,r=i.getBossCoinNode();if(r.setParent(o),r.setWorldPosition(t),Te.sndMgr.playOneShot("Collect_02"),Gt(r,"",Bi.Normal,(function(){i.putToBossCoinPool(r),null==n||n()})),e>0){var s=Ci.set(t);s.x+=80,s.y-=80,this.showWinNum(s,e)}},i.showWinNum=function(t,e){if(!(e<=0)){var n=Te.dataMgr,i=Te.node.rewardLayer,o=n.getWinNumNode();o.setParent(i),o.setWorldPosition(t),o.getComponentInChildren(H).string="+"+Yt(e),Jt(o,.2,1,255,Kt(1.5)).start(),T(o).by(.9,{position:v(0,M.randomRange(70,110),0)},he.opts.easeOut_2).delay(.5).call((function(){Jt(o,.4,-1,0,Kt(1.5)).call((function(){A.stopAllByTarget(o),n.putToWinNumPool(o)})).start()})).start()}},i.showMissText=function(t){var e=Te.dataMgr,n=Te.node.rewardLayer,i=e.getMissTextNode();i.setParent(n),i.setWorldPosition(t),Jt(i,.2,1,255,Kt(1.5)).start(),T(i).by(.6,{position:v(0,M.randomRange(50,90),0)},he.opts.easeOut_2).delay(.3).call((function(){Jt(i,.3,-1,0,Kt(1.5)).call((function(){A.stopAllByTarget(i),e.putToMissTextPool(i)})).start()})).start()},i.playWaterSplashFx=function(t,e,n){void 0===n&&(n=!0);var i=Te.dataMgr,o=Te.node.waterLayer,r=new x("WaterSplashFx");r.setParent(o),r.setWorldPosition(t),r.setScale(e,e,e);var s=M.randomRange;if($t(r,.1,4,(function(){var t=s(1,1.5),e=i.getWaterRippleNode();e.setParent(r),e.setPosition(s(-10,10),0,s(-10,10)),e.setScale(s(1,1.2),1,s(1,1.2)),e.setRotationFromEuler(0,s(0,360),0);var n=s(20,45)*(Math.random()>.5?1:-1);T(e).by(.8,{eulerAngles:v(0,n,0)}).start(),T(e.getComponent(zt)).set(he.props.opacity_255).delay(.35/t).to(1.5/t,he.props.opacity_0).start(),T(e).to(2/t,{scale:v(e.scale).multiplyScalar(2)}).call((function(){A.stopAllByTarget(e),i.putToWaterRipplePool(e)})).start()})),n){Te.sndMgr.playOneShot("Water_Splash_Small");var a=0;$t(r,.0333,4,(function(){var t=s(1,1.5),e=i.getWaterSplashNode();e.setParent(r);var n=M.randomRangeInt(0,e.children.length);switch(e.children.forEach((function(t,e){return t.active=e===n})),a++){case 0:e.setPosition(s(-10,0),0,s(0,10));break;case 1:e.setPosition(s(0,10),0,s(0,10));break;case 2:e.setPosition(s(-10,0),0,s(-10,0));break;case 3:e.setPosition(s(0,10),0,s(-10,0))}T(e.getComponent(zt)).set(he.props.opacity_255).delay(.3/t).to(.4/t,he.props.opacity_0).start(),T(e).to(.2/t,{scale:v(1.2,2,1),position:v(0,20,0).add(e.position)}).to(.8/t,{scale:v(.66,1,1),position:v(0,-50,0).add(e.position)}).call((function(){A.stopAllByTarget(e),i.putToWaterSplashPool(e)})).start()}))}ee(r,2,(function(){r.destroy()}))},i.makeMonsterFly=function(t,e,n){for(var i,o=M.randomRange,s=v(),a=v(),l=v(),u=function(){var e=i.value;if(!e.isUsing()||!e.node)return"continue";e.stopMove(),e.setUsing(!1),e.colliders.forEach((function(t){return t.enabled=!1})),Te.monsterMgr.removeFromEntitiesMap(e.getID());var r=0;l.set(e.node.worldPosition).subtract(t),l.normalize().multiplyScalar(l.z>=0?500:600);var u=v(l.x,l.z>=0?750:1350,l.z),c=v(o(-60,60),o(-60,60),o(-60,60)),h=e.node;Te.sndMgr.playOneShot(e.getHurtSndName()),null==n||n(e),Qt(h,(function(t){var n=Math.min(.1,U.deltaTime);if(r>=3.5)return t.stop(),void e.pushToPool();s.set(u).multiplyScalar(n).add(h.position),a.set(c).multiplyScalar(n).add(h.eulerAngles),h.setRotationFromEuler(a),h.setPosition(s),u.y+=-2e3*n,r+=n}))},c=r(e);!(i=c()).done;)u()},i.getWaterHeight=function(){return Te.node.waterLayer.worldPosition.y-28},n}(g));s._RF.pop(),s._RF.push({},"495daYmr7pLHaRJnstXPUSd","GameCtrl",void 0);var Ri,_i=u.ccclass;u.property,_i("GameCtrl")(Ti=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this).isInit=!1,e.playerTurret=null,e.playerCoins=0,e.betIndex=0,e.betList=[0],e.walletBuffer=0,e.RTP=.97,e}e(n,t);var i=n.prototype;return i.onLoad=function(){Te.gameCtrl=this,Te.dataMgr.freeOnStageDestroy((function(){return Te.gameCtrl=null})),this.playerTurret=this.getComponentInChildren(yi),this.devTestInit(),a.isBrowser&&a.isMobile&&a.os!==a.OS.IOS&&te(this.node,2.5,(function(){document.fullscreenElement||document.documentElement.requestFullscreen()}))},i.onDestroy=function(){A.stopAllByTarget(this.node),Te.shootingMgr.onCancelShootFunc=null},i.start=function(){this.gameInit()},i.gameInit=function(){var t=this,e=Te.uiCtrl.blackScreenNode;e.active=!0,ee(this.node,0,(function(){t.joinTable(),t.isInit=!0,Jt(e,.7,255,0,Kt(1.5)).call((function(){ie(e,255),e.active=!1})).start()}))},i.joinTable=function(){var t=this;this.betList.length=0,this.betList.push(1,2,3,4,5,6,7,8,9,10,20,30,40,50,60,70,80,90,100),this.betIndex=0,this.playerCoins=1e4,this.playerTurret.showLocationHint(!0),Te.uiCtrl.setSessionText(Xt(1e4,99999)),Te.uiCtrl.updatePlayerCoins(),Te.uiCtrl.updatePlayerBet(),Te.shootingMgr.onCancelShootFunc=function(e,n,i,o){t.addPlayerCoins(o),Te.uiCtrl.updatePlayerCoins()},Te.setValue("Main_BGM","BGM_01"),Te.sndMgr.playMusic("BGM_01",!0)},i.checkKill=function(t,e){for(var n,i=this.RTP/t.getOdds(),o=(n=e.type)===re||n===se?1:n===ae?5:1,r=0,s=!1,a=0;a<o;++a)if(r+=1,Math.random()<i){s=!0;break}if(r<o){var l=(o-r)*(e.cost/o);this.walletBuffer+=l}if(!s&&this.walletBuffer>=e.bet)for(var u=e.bet,c=Math.floor(this.walletBuffer/u),h=0;h<c;++h)if(this.walletBuffer-=u,Math.random()<i){s=!0;break}return s},i.getPlayerTurret=function(){return this.playerTurret},i.getPlayerBet=function(){return this.betList[this.betIndex]},i.getPlayerCoins=function(){return this.playerCoins},i.addPlayerCoins=function(t){var e=Math.max(0,this.playerCoins+t);return this.playerCoins=e,e},i.getBetList=function(){return this.betList},i.setBetIndex=function(t){var e=this.betList.length-1;return this.betIndex=f(t,0,e)},i.getBetIndex=function(){return this.betIndex},i.isReadyToPlay=function(){return this.isInit},i.devTestInit=function(){var t=this;At.isDevTest&&(G.on(V.EventType.KEY_DOWN,this.keyDownTest,this),Te.dataMgr.freeOnStageDestroy((function(){G.off(V.EventType.KEY_DOWN,t.keyDownTest,t)})))},i.keyDownTest=function(t){switch(t.keyCode){case X.F4:var e=Te.shootingMgr.getCoolDownRate();Te.shootingMgr.setCoolDownRate(e<=1?3:1);break;case X.SPACE:}},o(n,[{key:"timer",get:function(){return this.node}}]),n}(g));s._RF.pop(),s._RF.push({},"60cddKwsYdEB4ZLq3a5U+nO","Initializer",void 0);var Fi,Ni=u.ccclass;u.property,Ni("Initializer")(Ri=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var i=n.prototype;return i.onLoad=function(){this.init(),this.freeOnStageDestroy()},i.init=function(){var t=Te.node;t.stage=oe("Canvas/Stage"),t.display=oe(t.stage,"Display"),t.scene=oe(t.display,"Scene"),t.ui=oe(t.display,"UI");var e=t.scene;t.riverLayer=oe(e,"RiverLayer"),t.waterLayer=oe(e,"WaterLayer"),t.landLayer=oe(e,"LandLayer"),t.cannonLayer=oe(e,"CannonLayer"),t.bulletLayer=oe(e,"BulletLayer"),t.enemyLayer=oe(e,"EnemyLayer"),t.effect3DLayer=oe(e,"EffectLayer");var n=t.ui;t.touchPanel=oe(n,"TouchPanel"),t.effect2DLayer=oe(n,"EffectLayer"),t.playerLayer=oe(n,"PlayerLayer"),t.buttonLayer=oe(n,"ButtonLayer"),t.rewardLayer=oe(n,"RewardLayer"),t.noticeLayer=oe(n,"NoticeLayer"),t.uiLayer=oe(n,"UILayer"),Te.cam2D=oe(t.stage,"Camera/UI Camera",q),Te.cam3D=oe(t.stage,"Camera/3D Camera",q)},i.freeOnStageDestroy=function(){var t=this,e=x.EventType.NODE_DESTROYED;Te.node.stage.once(e,(function(){var n=new x("_");n.setParent(Te.node.stage),n.once(e,(function(){k.emit("__Free__"),t.free()}))}))},i.free=function(){var t=Te.node;Object.keys(t).forEach((function(e){t[e]=null})),Te.cam2D=null,Te.cam3D=null},n}(g));s._RF.pop(),s._RF.push({},"1fa10p2fVpLhbtMp8tgHSbs","MonsterMgr",void 0);var Ai,Di=u.ccclass;u.property,Di("MonsterMgr")(Fi=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this).entities=new Map,e}e(n,t);var i=n.prototype;return i.onLoad=function(){Te.monsterMgr=this,Te.dataMgr.freeOnStageDestroy((function(){return Te.monsterMgr=null}))},i.onDestroy=function(){this.entities.clear()},i.addEntity=function(t,e,n){var i,o=null==(i=Te.dataMgr.getMonsterNode(t))?void 0:i.getComponent(mn);if(!o)return d("Monster adding failed. No: "+t+", ID: "+e+"."),null;var r=this.entities;if(r.has(e))return d("Monster already exists. ID: "+e+"."),Te.dataMgr.putToMonsterPool(o.node,t),null;var s=o.node;return s.name="Monster_"+e,s.setParent(Te.node.enemyLayer),o.init(t,e),o.setMovePath(n)?(o.postInit(),r.set(e,o),o):(d("Monster has no path. PathNo: "+n+"."),Te.dataMgr.putToMonsterPool(o.node,t),null)},i.entityOnHit=function(t,e){if(Te.gameCtrl.checkKill(t,e)){var n=t.getOdds()*e.bet;t.showReward(n)||(Te.gameCtrl.addPlayerCoins(n),Te.uiCtrl.updatePlayerCoins()),t.showDeath()}},i.removeFromEntitiesMap=function(t){var e,n=this.entities,i=null!=(e=n.get(t))?e:null;return i&&n.delete(t),i},i.clearAllEntities=function(){var t=this.entities;Array.from(t.values()).forEach((function(t){return t.pushToPool()})),t.clear()},i.getEntitiesMap=function(){return this.entities},i.getAllEntities=function(t){var e=this.entities;if(t){for(var n,i=r(e.values());!(n=i()).done;){var o=n.value;t.push(o)}return t}return Array.from(e.values())},i.getEntitiesInRange=function(t,e,n,i){void 0===n&&(n=-1);var o=this.getAllEntities(),r=e*e;i||(i=function(t){return t.isNormalMonster&&t.isUsing()});for(var s=0;s<o.length;){var a=o[s];if(L.squaredDistance(t,a.node.worldPosition)>r||!i(a)){if(o.length>=2){var l=o.length-1,u=[o[l],o[s]];o[s]=u[0],o[l]=u[1]}o.pop()}else++s}if(function(t){var e=t.length;if(e>=2)for(var n=Math.floor,i=Math.random,o=e-1;o>0;--o){var r=n(i()*(o+1)),s=[t[r],t[o]];t[o]=s[0],t[r]=s[1]}}(o),n>0)for(var c=0,h=0,d=o.length;h<d;++h){if((c+=o[h].getOdds())>=n){o.length=h+1;break}}return o},i.getEntityByID=function(t){var e;return null!=(e=this.entities.get(t))?e:null},n}(g));s._RF.pop(),s._RF.push({},"aed29q0X5NEnqte/Iy6p1vR","ShootingMgr",void 0);var Ii,Ei,zi,Li,Oi,ki,Wi,Hi=v(),Ui=v(),Gi=v(),Vi=u.ccclass;u.property,Vi("ShootingMgr")(Ai=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this).onCancelShootFunc=null,e.shootMode=re,e.isAiming=!1,e.isPressing=!1,e.shootWorldPos=v(),e.sightUINode=null,e.sightAimUINode=null,e.lastAimingNo=-1,e.lastAimingID=-1,e.aimTarget=null,e.tmpRaycastResults=[],e.tmpShootRecord={bltID:0,bltBet:0,bltCost:0,aimingID:0,shootMode:0,isShot:!1},e.coolDownTimer=9999,e.coolDownRate=1,e.nextBltID=1,e}e(n,t);var i=n.prototype;return i.onLoad=function(){Te.shootingMgr=this,Te.dataMgr.freeOnStageDestroy((function(){return Te.shootingMgr=null}));var t=Te.node.playerLayer;this.sightUINode=oe(t,"UI/Aim/Sight"),this.sightAimUINode=oe(t,"UI/Aim/Sight_Aim")},i.onDestroy=function(){this.onCancelShootFunc=null,this.aimTarget=null},i.update=function(t){Te.gameCtrl.isReadyToPlay()&&this.updateShootingStates(t)},i.start=function(){this.init()},i.init=function(){var t=this;Qt(this.node,(function(e){if(Te.gameCtrl.isReadyToPlay()){var n=Te.gameCtrl.getPlayerTurret();t.coolDownTimer=n.cannon.getCoolDownTime(),t.touchPanelSetup(),e.stop()}}))},i.touchPanelSetup=function(){var t=this,e=Te.node.touchPanel,n=x.EventType,i=v(),o=v();e.on(n.TOUCH_START,(function(e){t.setTouchToShoot(!0),t.updateTouchPos(n.TOUCH_START,Wt(e,i),Ht(e,o))})),e.on(n.TOUCH_MOVE,(function(e){t.setTouchToShoot(!0),t.updateTouchPos(n.TOUCH_MOVE,Wt(e,i),Ht(e,o))})),e.on(n.TOUCH_END,(function(e){t.setTouchToShoot(!1)})),e.on(n.TOUCH_CANCEL,(function(e){t.setTouchToShoot(!1)}))},i.updateTouchPos=function(t,e,n){if(function(t,e,n,i){var o=t.screenPointToRay(e.x,e.y,Lt),r=o.o,s=o.d;if(0!==s.y){var a=(n-r.y)/s.y;if(a>=0)return i.set(s).multiplyScalar(a).add(r),!0}}(Te.cam3D,e,0,this.shootWorldPos),this.sightUINode.setWorldPosition(n),Te.gameCtrl.getPlayerTurret().cannon.isNeedTarget()){var i=this.aimTarget,o=this.getTargetByRayCasting(e);if(this.isAiming){if(t===x.EventType.TOUCH_START){o&&(this.aimTarget=o),this.isAiming&&i===o&&i&&o&&this.aimReset();var r=this.aimTarget;if(r){var s=r.node.worldPosition;this.shootWorldPos.set(s)}}}else{var a=this.aimTarget=o;if(a){var l=a.node.worldPosition;this.shootWorldPos.set(l)}}}else this.aimTarget=null},i.setTouchToShoot=function(t){this.sightUINode.active=t,this.isPressing=t},i.getTargetByRayCasting=function(t){var e=z.PhysicsGroup;if(this.tmpRaycastResults.length=0,!function(t,e,n,i){var o=t.screenPointToRay(e.x,e.y,Lt),r=w.instance.raycast(o,n);if(r)for(var s=w.instance.raycastResults,a=0,l=s.length;a<l;++a){var u=s[a];i.push(u.collider.node)}return r}(Te.cam3D,t,e.MONSTER,this.tmpRaycastResults))return null;for(var n,i=null,o=r(this.tmpRaycastResults);!(n=o()).done;){var s=n.value.getComponent(mn);if(s&&s.isUsing()){i=s;break}}return this.tmpRaycastResults.length=0,i},i.setSightAimUIPos=function(t){var e=Ut(Te.cam3D,Te.cam2D,t,Gi);this.sightAimUINode.setWorldPosition(e)},i.playSightAimUIAiming=function(){var t=this;this.sightAimUINode.active&&Gt(this.sightAimUINode,"Sight_Aim",null,(function(){Gt(t.sightAimUINode,"Sight_Aim_Loop")}))},i.updateShootingStates=function(t){this.coolDownTimer=this.coolDownTimer-t*this.coolDownRate,this.coolDownTimer=Math.max(0,this.coolDownTimer),this.isAiming&&-1===this.getAimingID()&&(this.sightAimUINode.active=!1,this.aimTarget=null);var e=Te.gameCtrl.getPlayerTurret();if(e.isLocked())this.sightAimUINode.active=!1;else{var n=this.isAiming&&e.cannon.isNeedTarget();if(this.sightAimUINode.active&&this.aimTarget){var i=this.getAimingWorldPos(this.aimTarget,Ui);this.setSightAimUIPos(i),this.checkShootRangeByPos2D(this.sightAimUINode.position)||(this.sightAimUINode.active=!1,n&&(this.aimTarget=null))}this.coolDownTimer<=0&&(n?(this.aimTarget||this.searchAimTargetByNo(this.lastAimingNo))&&this.readyToShoot():this.isPressing&&this.readyToShoot())}},i.readyToShoot=function(){var t=Te.gameCtrl,e=Te.uiCtrl,n=t.getPlayerTurret();if(!n.isLocked()){var i=n.cannon.getShootingCost();if(i>t.getPlayerCoins())return e.toast.show("餘額不足，無法發射子彈！"),void(this.isAiming&&(this.sightAimUINode.active=!1,this.aimTarget=null));if(this.checkShootRangeByWorldPos3D(this.shootWorldPos)){var o=this.aimTarget,r=n.getWorldPos().x,s=r-n.cannon.getShootWorldPosX();o&&o.isUsing()?n.moveToWorldPosX(o.node.worldPosition.x+s):n.moveToWorldPosX(this.shootWorldPos.x+s);var a=t.getPlayerBet(),l=this.tmpShootRecord;if(n.cannon.tryToShoot(a,i,l),l.isShot){if(this.coolDownTimer=n.cannon.getCoolDownTime(),t.addPlayerCoins(-i),e.updatePlayerCoins(),this.isAiming){var u=this.getAimingWorldPos(o,Ui);this.shootWorldPos.set(u);var c=this.lastAimingID,h=o.getID();h!==c&&(this.lastAimingNo=o.getNo(),this.lastAimingID=h,this.sightAimUINode.active=!0,this.setSightAimUIPos(u),this.playSightAimUIAiming())}}else n.moveToWorldPosX(r)}}},i.checkShootRangeByWorldPos3D=function(t){var e=Ut(Te.cam3D,Te.cam2D,t,Gi);return this.checkShootRangeByWorldPos2D(e)},i.checkShootRangeByWorldPos2D=function(t){var e,n,i,o,r=(e=Te.node.stage,n=t,i=null!=(o=i=Hi)?o:v(),(e.node?e:e.getComponent(P)).convertToNodeSpaceAR(n,i));return this.checkShootRangeByPos2D(r)},i.checkShootRangeByPos2D=function(t){var e=.45*ne(Te.node.stage,-1,-1).width;return Math.abs(t.x)<e},i.getAimingWorldPos=function(t,e){var n=t.aimNodes,i=null!=e?e:v();if(0===n.length)return i.set(t.node.worldPosition);for(var o,s=r(n);!(o=s()).done;){var a=o.value;if(this.checkShootRangeByWorldPos3D(a.worldPosition))return i.set(a.worldPosition)}return i.set(n[0].worldPosition)},i.searchAimTargetByNo=function(t){if(-1!==t)for(var e,n=Te.monsterMgr.getEntitiesMap(),i=r(n.values());!(e=i()).done;){var o=e.value;if(o.getNo()===t&&o.isUsing()){var s=this.getAimingWorldPos(o,Ui);if(this.checkShootRangeByWorldPos3D(s))return this.shootWorldPos.set(s),this.aimTarget=o,this.isAiming&&(this.sightAimUINode.active=!0,this.setSightAimUIPos(s),t!==this.lastAimingNo&&this.playSightAimUIAiming()),!0}}return this.sightAimUINode.active=!1,this.aimTarget=null,!1},i.getAimingID=function(){if(!Te.gameCtrl.getPlayerTurret().cannon.isNeedTarget())return-1;var t=this.aimTarget;return t&&t.isUsing()?t.getID():-1},i.aimReset=function(){this.sightAimUINode.active=!1,this.lastAimingNo=-1,this.lastAimingID=-1,this.aimTarget=null},i.cancelShoot=function(t,e,n,i){var o;null==(o=this.onCancelShootFunc)||o.call(this,t,e,n,i)},i.setCoolDownRate=function(t){this.coolDownRate=t},i.getCoolDownRate=function(){return this.coolDownRate},i.peekNextBulletID=function(){return this.nextBltID},i.newBulletID=function(){return++this.nextBltID},n}(g));s._RF.pop(),s._RF.push({},"819e0ivTqxPD46918g9gWGI","SoundMgr",void 0);var Xi,qi,Zi,ji,Yi,Ki,Ji,Qi=u.ccclass,$i=u.property;Ii=Qi("SoundMgr"),Ei=$i({tooltip:"音樂所在的 Bundle 名稱"}),zi=$i({tooltip:"音效所在的資料夾名稱"}),Ii((ki=t((Oi=function(t){function r(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"bundleName",ki,i(e)),n(e,"sndDir",Wi,i(e)),e.isMute=!1,e.musicVol=1,e.effectVol=1,e.__isMute=!1,e.__musicVol=1,e.__effectVol=1,e.sndMap=new Map,e.waitingList=new Map,e.audioSrcList=new Array,e.isBlockPlayEffect=!1,e}e(r,t);var s=r.prototype;return s.onLoad=function(){Te.sndMgr=this,Te.dataMgr.freeOnStageDestroy((function(){return Te.sndMgr=null})),this.init()},s.onDestroy=function(){U.off(Z.EVENT_SHOW,this.onDisplay,this),U.off(Z.EVENT_HIDE,this.onHidden,this),A.stopAllByTarget(this.node),this.audioSrcList.length=0,this.waitingList.clear(),this.sndMap.clear()},s.init=function(){this.preloadSndDir(),this.audioSrcList.push(this.node.addComponent(j)),this.audioSrcList.push(this.node.addComponent(j)),this.audioSrcList.forEach((function(t){return t.playOnAwake=!1})),this.effectVolume=.75,this.musicVolume=.85,this.saveStates(),U.on(Z.EVENT_SHOW,this.onDisplay,this),U.on(Z.EVENT_HIDE,this.onHidden,this),this.isBlockPlayEffect=!1,this.checkBrowserIssue()},s.checkBrowserIssue=function(){var t=this;if(a.isBrowser&&"FALSE"!==Te.getValue("IsBlockPlayEffect")){this.isBlockPlayEffect=!0;document.addEventListener("pointerdown",(function(){t.isBlockPlayEffect=!1,Te.setValue("IsBlockPlayEffect","FALSE")}),{once:!0})}},s.saveStates=function(){this.__isMute=this.isMute,this.__musicVol=this.musicVol,this.__effectVol=this.effectVol},s.onDisplay=function(){this.__isMute||(this.mute=!1),this.musicVolume=this.__musicVol,this.effectVolume=this.__effectVol},s.onHidden=function(){this.saveStates(),this.isMute||(this.mute=!0)},s.preloadSndDir=function(){var t=this,e={dir:this.sndDir,bundle:this.bundleName},n={type:K,priority:-1};Y.loadAny(e,n,(function(e,n){if(e)d(e.message);else{var i=t.sndMap;n.forEach((function(e){var n=e.name;i.set(n,e),function(e){var n=t.waitingList;if(n.has(e)){var i=n.get(e);n.delete(e),i.forEach((function(e){"Music"===e.type&&t.playMusic(e.name,e.loop),"Effect"===e.type&&t.playEffect(e.name,e.loop,e.interrupt)}))}}(n)}))}}))},s.addToWaitingList=function(t){var e,n=t.name,i=this.waitingList,o=null!=(e=i.get(n))?e:[];i.set(n,o),o.push(t)},s.playMusic=function(t,e){if(""!==t){this.stopMusic();var n=this.sndMap.get(t);if(n){var i=this.audioSrcList[0];i.clip=n,i.loop=e,i.play()}else{this.addToWaitingList({type:"Music",name:t,loop:e,interrupt:!0})}}},s.playEffect=function(t,e,n,i){if(void 0===i&&(i=!1),""!==t){var o=this.sndMap.get(t);if(o){if(!this.isMute&&!this.isBlockPlayEffect)if(n||e){n&&this.stopEffect(t);var r=new x(t),s=r.addComponent(j),a=this.isMute?0:this.effectVol;r.setParent(this.node),s.playOnAwake=!1,s.volume=a,s.clip=o,s.loop=e,s.play(),e||r.once(j.EventType.ENDED,(function(){r.destroy()}))}else this.playOneShot(t)}else if(i){this.addToWaitingList({type:"Effect",name:t,loop:e,interrupt:n})}}},s.playOneShot=function(t){if(""!==t&&!this.isMute&&!this.isBlockPlayEffect){var e=this.sndMap.get(t);if(e)this.audioSrcList[1].playOneShot(e)}},s.stopMusic=function(){var t=this.audioSrcList[0];t.clip&&t.playing&&t.stop();var e=this.waitingList;Array.from(e.values()).forEach((function(t){"Music"!==t[0].type||e.delete(t[0].name)}))},s.stopEffect=function(t){for(var e=this.node.children,n=e.length-1;n>=0;--n){var i,o=e[n];if(o.name===t)null==(i=o.getComponent(j))||i.stop(),o.destroy()}var r=this.waitingList;Array.from(r.values()).forEach((function(e){e[0].name!==t||"Effect"!==e[0].type||r.delete(e[0].name)}))},o(r,[{key:"musicVolume",get:function(){return this.musicVol},set:function(t){var e=this.isMute?0:t;this.musicVol=t,this.audioSrcList[0].volume=e}},{key:"effectVolume",get:function(){return this.effectVol},set:function(t){var e=this.isMute?0:t;this.effectVol=t,this.audioSrcList[1].volume=e;for(var n=this.node.children,i=n.length-1;i>=0;--i){n[i].getComponent(j).volume=e}}},{key:"mute",get:function(){return this.isMute},set:function(t){this.isMute=t,this.musicVolume=this.musicVol,this.effectVolume=this.effectVol}}]),r}(g)).prototype,"bundleName",[Ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"game"}}),Wi=t(Oi.prototype,"sndDir",[zi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"res/sound"}}),Li=Oi));s._RF.pop(),s._RF.push({},"8a9186QtEVL+a3eVbp8Y+OV","Toast",void 0);var to,eo,no,io,oo,ro,so,ao,lo,uo,co,ho,po,fo,go,mo,yo,vo,bo,Po,wo,So,Mo,To,Bo,Co,xo,Ro=u.ccclass,_o=u.property,Fo=(Xi=Ro("Toast"),qi=_o(x),Zi=_o(H),Xi((Ki=t((Yi=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"pivotNode",Ki,i(e)),n(e,"contentText",Ji,i(e)),e}e(o,t);var r=o.prototype;return r.onLoad=function(){this.pivotNode.active=!1},r.show=function(t){var e=this;this.pivotNode.active=!0,this.contentText.string=t,A.stopAllByTarget(this.pivotNode),ie(this.pivotNode,255),ee(this.pivotNode,2,(function(){Jt(e.pivotNode,.5,-1,0,Kt(2)).call((function(){return e.pivotNode.active=!1})).start()}))},r.hide=function(){A.stopAllByTarget(this.pivotNode),this.pivotNode.active=!1},r.setPosition=function(t){this.pivotNode.setPosition(t)},r.setWorldPosition=function(t){this.pivotNode.setWorldPosition(t)},o}(g)).prototype,"pivotNode",[qi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ji=t(Yi.prototype,"contentText",[Zi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ji=Yi))||ji);s._RF.pop(),s._RF.push({},"c35afVxNP9MhKZ3SNf03MsK","UICtrl",void 0);var No=1,Ao=2,Do=u.ccclass,Io=u.property;to=Do("UICtrl"),eo=Io({type:x,tooltip:"炮台位置提示"}),no=Io({type:H,tooltip:"遊戲局號文字"}),io=Io({type:H,tooltip:"玩家的押注額文字"}),oo=Io({type:H,tooltip:"玩家的剩餘財產文字"}),ro=Io({type:J,tooltip:"押注額調整按鈕"}),so=Io({type:J,tooltip:"押注額調整按鈕"}),ao=Io({type:[J],tooltip:"遊戲功能按鈕"}),lo=Io({type:[x],tooltip:"遊戲功能按鈕的啟用效果"}),uo=Io({type:[x],tooltip:"遊戲功能按鈕的使用花費介面"}),co=Io({type:[x],tooltip:"遊戲功能按鈕的文字節點"}),ho=Io({type:x,tooltip:"全畫面的黑色遮罩"}),po=Io({type:Fo,tooltip:"Toast 文字框"}),to((mo=t((go=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"locationHintNode",mo,i(e)),n(e,"sessionText",yo,i(e)),n(e,"playerBetText",vo,i(e)),n(e,"playerCoinsText",bo,i(e)),n(e,"minusBetBtn",Po,i(e)),n(e,"plusBetBtn",wo,i(e)),n(e,"lstFuncBtn",So,i(e)),n(e,"lstFuncBtnFx",Mo,i(e)),n(e,"lstFuncBtnCost",To,i(e)),n(e,"lstFuncBtnName",Bo,i(e)),n(e,"blackScreenNode",Co,i(e)),n(e,"toast",xo,i(e)),e.minusBetTween=null,e.plusBetTween=null,e.coinUIWpos3D=v(320,320,700),e}e(o,t);var r=o.prototype;return r.onLoad=function(){Te.uiCtrl=this,Te.dataMgr.freeOnStageDestroy((function(){return Te.uiCtrl=null}))},r.onDestroy=function(){var t,e;null==(t=this.minusBetTween)||t.stop(),null==(e=this.plusBetTween)||e.stop(),this.minusBetTween=null,this.plusBetTween=null},r.start=function(){this.init()},r.init=function(){var t=x.EventType.TOUCH_START,e=x.EventType.TOUCH_END,n=x.EventType.TOUCH_CANCEL;this.minusBetBtn.node.on(t,this.minusBetBtnOnClick,this),this.plusBetBtn.node.on(t,this.plusBetBtnOnClick,this),this.minusBetBtn.node.on(e,this.minusBetBtnOnClickEnd,this),this.plusBetBtn.node.on(e,this.plusBetBtnOnClickEnd,this),this.minusBetBtn.node.on(n,this.minusBetBtnOnClickEnd,this),this.plusBetBtn.node.on(n,this.plusBetBtnOnClickEnd,this);var i=J.EventType.CLICK;this.lstFuncBtn[No].node.on(i,this.axeBtnOnClick,this),this.lstFuncBtn[Ao].node.on(i,this.aimBtnOnClick,this)},r.setSessionText=function(t){for(var e=[],n=0;n<18;++n)e.push("0123456789".charAt(M.pseudoRandomRangeInt(t,0,10))),t=M.pseudoRandomRangeInt(t,1e3,9999);this.sessionText.string=e.join("")},r.updatePlayerBet=function(){var t=Yt(Te.gameCtrl.getPlayerBet());this.playerBetText.string=t,this.updateBetBtnStates(),this.updateFuncBtnCosts()},r.updatePlayerCoins=function(){var t=Yt(Te.gameCtrl.getPlayerCoins());this.playerCoinsText.string=t},r.getPlayerCoinUIWpos3D=function(){return this.coinUIWpos3D},r.updateBetBtnStates=function(){var t=Te.gameCtrl,e=t.getBetList(),n=t.getBetIndex(),i=12;0===n?i=6:n===e.length-1&&(i=9),this.minusBetBtn.interactable=!!(8&i),this.plusBetBtn.interactable=!!(4&i),this.minusBetBtn.node.children[0].active=!!(2&i),this.plusBetBtn.node.children[0].active=!!(1&i)},r.updateFuncBtnCosts=function(){var t=Te.gameCtrl.getPlayerBet();this.updateFuncBtnCost(No,t*ue)},r.updateFuncBtnCost=function(t,e){var n=this.lstFuncBtnCost[t].children[0];if(n&&"Cost"===n.name){var i=n.getComponentInChildren(H);i&&(i.string=Yt(e))}},r.changePlayerBet=function(t){var e=Te.gameCtrl,n=e.getBetIndex();return e.setBetIndex(n+t),e.getBetIndex()!==n&&(this.updatePlayerBet(),!0)},r.minusBetBtnOnClick=function(){var t=this;if(this.changePlayerBet(-1)&&Te.sndMgr.playOneShot("Switch"),!this.minusBetTween&&!this.plusBetTween){var e=.333;this.minusBetTween=te(this.node,.15,(function(){e<=0?t.minusBetBtnOnClick():e-=.15}))}},r.plusBetBtnOnClick=function(){var t=this;if(this.changePlayerBet(1)&&Te.sndMgr.playOneShot("Switch"),!this.minusBetTween&&!this.plusBetTween){var e=.333;this.plusBetTween=te(this.node,.15,(function(){e<=0?t.plusBetBtnOnClick():e-=.15}))}},r.minusBetBtnOnClickEnd=function(){var t;null==(t=this.minusBetTween)||t.stop(),this.minusBetTween=null},r.plusBetBtnOnClickEnd=function(){var t;null==(t=this.plusBetTween)||t.stop(),this.plusBetTween=null},r.setAxeBtnUIEnable=function(t){var e=No;this.lstFuncBtnFx[e].children[0].active=t,this.lstFuncBtnCost[e].children[0].active=t,this.lstFuncBtnName[e].children[0].active=!t},r.setAimBtnUIEnable=function(t){var e=Ao;this.lstFuncBtnFx[e].children[0].active=t},r.axeBtnOnClick=function(){var t=No,e=!this.lstFuncBtnFx[t].children[0].active;this.setAxeBtnUIEnable(e),Te.sndMgr.playOneShot("Switch");var n=Te.shootingMgr,i=n.shootMode;n.shootMode=e?ae:re,n.isAiming&&!e&&(n.shootMode=se),i!==n.shootMode&&Te.gameCtrl.getPlayerTurret().cannon.equip()},r.aimBtnOnClick=function(){var t=Ao,e=!this.lstFuncBtnFx[t].children[0].active;this.setAimBtnUIEnable(e),Te.sndMgr.playOneShot("Switch");var n=Te.shootingMgr;n.isAiming=e,n.aimReset();var i=n.shootMode;i===re&&(n.shootMode=se),i===se&&(n.shootMode=re),i!==n.shootMode&&Te.gameCtrl.getPlayerTurret().cannon.equip()},o}(g)).prototype,"locationHintNode",[eo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yo=t(go.prototype,"sessionText",[no],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vo=t(go.prototype,"playerBetText",[io],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bo=t(go.prototype,"playerCoinsText",[oo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Po=t(go.prototype,"minusBetBtn",[ro],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wo=t(go.prototype,"plusBetBtn",[so],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),So=t(go.prototype,"lstFuncBtn",[ao],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Mo=t(go.prototype,"lstFuncBtnFx",[lo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),To=t(go.prototype,"lstFuncBtnCost",[uo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Bo=t(go.prototype,"lstFuncBtnName",[co],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Co=t(go.prototype,"blackScreenNode",[ho],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xo=t(go.prototype,"toast",[po],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fo=go));s._RF.pop(),s._RF.push({},"c766ebvMx1OTaSIDIUUswEm","MonsterNo",void 0);var Eo,zo,Lo,Oo,ko,Wo,Ho,Uo,Go,Vo=1,Xo=2,qo=3,Zo=4,jo=5,Yo=6,Ko=7;s._RF.pop(),s._RF.push({},"2991e5Gy0hDpLbGuBo1iVlC","OnBoardMonster",void 0);var Jo,Qo=O.WrapMode,$o=u.ccclass,tr=u.property,er=(Eo=$o("OnBoardMonster"),zo=tr({tooltip:"最大擊退距離"}),Lo=tr({tooltip:"最大擊退次數"}),Oo=tr({type:H,tooltip:"賠率的文字顯示"}),Eo((Ho=t((Wo=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"hitBackMaxDist",Ho,i(e)),n(e,"maxHitCnt",Uo,i(e)),n(e,"oddsText",Go,i(e)),e.hitCnt=0,e.isDown=!1,e.isRevival=!1,e.canShowHurt=!0,e.monsterNode=null,e.commonAnim=null,e.boardAnim=null,e}e(o,t);var r=o.prototype;return r.onLoad=function(){t.prototype.onLoad.call(this);var e=oe(this.node,"RootNode");this.monsterNode=oe(e,"MonsterNode"),this.commonAnim=oe(e,S),this.boardAnim=oe(this.monsterNode,"RootNode",S)},r.postInit=function(){var t=this;this.using=!1,this.revival(null,(function(){return t.playIdle()}))},r.pushToPool=function(){this.stopFloating(),t.prototype.pushToPool.call(this)},r.playIdle=function(){var t=this.monsterAnims;if(Math.random()<.5)Gt(t[0],"idle01");else{var e=qt(["idle02","idle03"]);Gt(t[0],e,Qo.Normal,(function(){Gt(t[0],"idle01")}))}},r.revival=function(t,e){var n=this;if(!this.isRevival){this.using=!1,this.isDown=!0,this.isRevival=!0,this.canShowHurt=!1,this.hitCnt=0,this.monsterNode.setPosition(0,0,0);var i=this.commonAnim,o=this.monsterAnims[0];o.node.setPosition(0,-5e3,0),Gt(i,"CommonIdle"),Gt(i,"CommonRevival",null,(function(){Gt(o,"ingame",Qo.Normal,(function(){null==e||e()})),ee(o.node,0,(function(){o.node.setPosition(0,0,0),n.showFloating(),n.colliders.forEach((function(t){return t.enabled=!0})),n.canShowHurt=!0,n.isRevival=!1,n.isDown=!1,n.using=!0,null==t||t()}))}))}},r.showFloating=function(){this.stopFloating();var t=this.commonAnim.node;T(t).to(2,de.props.positions[0]).to(2,de.props.positions[1]).to(2,de.props.positions[2]).to(2,de.props.positions[3]).union().repeatForever().tag(501).start(),T(t).to(0,de.props.angles[0]).to(1,de.props.angles[1]).to(4,de.props.angles[2]).to(3,de.props.angles[3]).union().repeatForever().tag(502).start()},r.stopFloating=function(){var t=this.commonAnim.node;A.stopAllByTag(501,t),A.stopAllByTag(502,t)},r.showHurt=function(t){this.showHitBack(t)},r.showHitBack=function(t){var e=this;if(this.canShowHurt&&this.using){this.hitCnt=f(this.hitCnt+t,0,this.maxHitCnt),this.damageTint(!0);var n=this.hitCnt,i=this.maxHitCnt,o=this.boardAnim,r=this.monsterAnims,s=n/i;if(s>=1)return this.monsterNode.setPosition(0,0,-this.hitBackMaxDist),Math.random()<.5&&Te.sndMgr.playOneShot(this.getHurtSndName()),Gt(o,"BoardDown",null,(function(){e.playIdle()})),void Gt(r[0],"up01",Qo.Normal,(function(){Gt(r[0],"up02")}));var a=Math.random()>.3?"hit":"super_hit",l=B(0,this.hitBackMaxDist,s);this.monsterNode.setPosition(0,0,-l),Math.random()<.5&&Te.sndMgr.playOneShot(this.getHurtSndName()),Gt(o,"BoardShake"),Gt(r[0],a,Qo.Normal,(function(){e.playIdle()}))}},r.showReward=function(t){this.using=!1,this.canShowHurt=!1,this.colliders.forEach((function(t){return t.enabled=!1}));var e=Te.effectMgr,n=e.getWaterHeight(),i=Te.uiCtrl.getPlayerCoinUIWpos3D(),o=v(this.node.worldPosition);return o.y=n,o.z+=40,e.showGetCoins(o,i,t,(function(){Te.gameCtrl.addPlayerCoins(t),Te.uiCtrl.updatePlayerCoins()})),!0},r.showDeath=function(){var t=this;this.using=!1,this.isDown=!0,this.canShowHurt=!1,this.stopFloating(),Gt(this.boardAnim,"BoardIdle"),Gt(this.commonAnim,"CommonDead"),Te.sndMgr.playOneShot(this.getHurtSndName());var e=Te.effectMgr,n=Te.effectMgr.getWaterHeight(),i=this.node,o=this.monsterAnims,r=this.colliders;ee(i,.73,(function(){var t=v(o[0].node.worldPosition);t.y=n,e.playWaterSplashFx(t,r[0].size.x/55)})),ee(i,1,(function(){var t=v(i.worldPosition);t.y=n,e.playWaterSplashFx(t,1,!1)})),ee(i,3,(function(){t.revival(null,(function(){return t.playIdle()}))}))},r.getHurtSndName=function(){switch(this.no){case Vo:case jo:return"Monster_Hurt_0"+Xt(1,5);case Xo:case qo:case Zo:return"Male_Hurt_0"+Xt(1,4);case Yo:return"Female_Hurt_0"+Xt(1,2)}return""},o}(mn)).prototype,"hitBackMaxDist",[zo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),Uo=t(Wo.prototype,"maxHitCnt",[Lo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),Go=t(Wo.prototype,"oddsText",[Oo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ko=Wo))||ko);s._RF.pop(),s._RF.push({},"16bd5NllD5DuKZStp5WqkbH","Shake2D",void 0);var nr,ir,or,rr,sr,ar,lr,ur,cr,hr=(0,u.ccclass)("Shake2D")(Jo=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this).shakingTween=null,e.endTween=null,e.oldPos=null,e}return e(n,t),n}(g))||Jo,dr={},pr=new Array(36);function fr(t,e,n,i,o){var r;if(void 0===o&&(o=1),t.activeInHierarchy){e=Math.max(0,e),n=Math.floor(Math.max(1,n));var s=pr[M.randomRangeInt(0,pr.length)],a=v(t.position),l=v(a),u=v(s).multiplyScalar(i).add(a),c=1/n,h=0,d=i,p=T(t).by(e,dr,{onUpdate:function(n,i){var r=e*i/c,s=Math.floor(r);if(s>h){var p=pr[M.randomRangeInt(0,pr.length)];h=s,d*=o,l.set(u),u.set(p).multiplyScalar(d).add(a)}var f=r-s;t.setPosition(B(l.x,u.x,f),B(l.y,u.y,f))}}),f=T(t).delay(e).call((function(){return function(t){if(!t||!t.isValid)return;var e=t.getComponent(hr);e&&(gr(t,e),e.destroy())}(t)})),g=t.getComponent(hr);g&&gr(t,g),(g=null!=(r=g)?r:t.addComponent(hr)).shakingTween=p.start(),g.endTween=f.start(),g.oldPos=a}}function gr(t,e){var n,i;if(null==(n=e.shakingTween)||n.stop(),null==(i=e.endTween)||i.stop(),e.oldPos){var o=e.oldPos;t.setPosition(o.x,o.y)}e.shakingTween=null,e.endTween=null,e.oldPos=null}!function(){for(var t=2*Math.PI,e=0,n=pr.length;e<n;++e){var i=t*(e/n),o=L.rotateZ(v(),L.UP,L.ZERO,i);pr[e]=o}}(),s._RF.pop(),s._RF.push({},"9a717fq0whErYgz/TjM+b5x","BombGoblin",void 0);var mr,yr,vr,br,Pr,wr=O.WrapMode,Sr=u.ccclass,Mr=u.property;nr=Sr("BombGoblin"),ir=Mr(x),or=Mr(_),rr=Mr(_),nr((lr=t((ar=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"lightBGNode",lr,i(e)),n(e,"explosionPrefab",ur,i(e)),n(e,"glassBrokenFxPrefab",cr,i(e)),e}e(o,t);var r=o.prototype;return r.init=function(e,n){t.prototype.init.call(this,e,n),this.oddsIndex=M.randomRangeInt(0,this.oddsList.length),this.oddsText.string="X"+Zt(this.oddsList)},r.revival=function(e,n){var i=this;this.oddsIndex=M.randomRangeInt(0,this.oddsList.length),this.lightBGNode.active=!1;t.prototype.revival.call(this,(function(){i.lightBGNode.active=!0,i.lightBGNode.getComponentsInChildren(Q).forEach((function(t){t.resetSystem(),t._simulator.step(0)})),null==e||e()}),n)},r.showReward=function(t){var e=this;this.using=!1,this.canShowHurt=!1,this.colliders.forEach((function(t){return t.enabled=!1})),Te.monsterMgr.removeFromEntitiesMap(this.id);var n=this.node,i=N(this.explosionPrefab);i.setParent(Te.node.effect3DLayer),i.setWorldPosition(this.node.worldPosition),Gt(i,"",wr.Normal,(function(){i.destroy()})),ee(n,.65,(function(){fr(Te.cam3D.node,1.3,25,10,.97)}));var o=Te.effectMgr,r=o.getWaterHeight(),s=Te.uiCtrl.getPlayerCoinUIWpos3D();return ee(n,.65,(function(){var t=e.node.worldPosition,n=Te.monsterMgr.getEntitiesInRange(t,500,e.getOdds());o.makeMonsterFly(t,n,(function(t){var e=v(t.node.worldPosition);e.y=r,e.z+=40,ee(Te.gameCtrl.timer,1.3,(function(){o.showGetCoins(e,s,0)}))})),ee(Te.gameCtrl.timer,.3,(function(){Te.sndMgr.playOneShot("Water_Splash_Small")}))})),this.stopFloating(),this.showBombGoblinFly(),ee(n,2,(function(){e.reuse=!1,Te.sndMgr.playOneShot("Water_Splash_Small"),Gt(e.commonAnim,"NoFallDead",null,(function(){n.destroy()}));var i=v(n.worldPosition);i.y=r,i.z+=40,o.showGetCoins(i,s,t,(function(){Te.gameCtrl.addPlayerCoins(t),Te.uiCtrl.updatePlayerCoins()})),ee(n,.3,(function(){var t=v(n.worldPosition);t.y=r,o.playWaterSplashFx(t,2,!1)}))})),!0},r.showBombGoblinFly=function(){var t=this,e=this.monsterAnims,n=this.node;Gt(e[0],"idle01"),this.lightBGNode.active=!1,this.reuse=!1;var i=qt([-1400,1400])/1,o=0,r=20,s=!1;ee(n,.65,(function(){e[0].stop(),Te.sndMgr.playOneShot("Boom_Fly");var a=oe(e[0].node,"Bip001");T(a).to(.1,{position:v(0,M.randomRange(5,7),0)}).call((function(){Qt(n,(function(e){var n=Math.min(.1,U.deltaTime);if(o>=2.8)e.stop();else{if(o<1){var l=a.position,u=a.eulerAngles,c=a.scale.x+2*n;a.setScale(c,c,c),a.setPosition(l.x,l.y,l.z+25*n),a.setRotationFromEuler(u.x+i*n,u.y,u.z)}else if(o>=1&&!s){var h=Ut(Te.cam3D,Te.cam2D,a.worldPosition),d=N(t.glassBrokenFxPrefab);d.setParent(Te.node.effect2DLayer),d.setWorldPosition(h),Gt(d,"",null,(function(){d.destroy()})),Te.sndMgr.playOneShot("Glass_Broken"),s=!0}else if(o>1.8&&o<2.8){var p=a.position;a.setPosition(p.x,p.y-r*n,p.z),r+=70*n}o+=n}}))})).start()}))},r.showDeath=function(){},o}(er)).prototype,"lightBGNode",[ir],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ur=t(ar.prototype,"explosionPrefab",[or],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cr=t(ar.prototype,"glassBrokenFxPrefab",[rr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sr=ar));s._RF.pop(),s._RF.push({},"92ddena355CAJX0VeNg/pt5","ClockTimerUI",void 0);var Tr,Br,Cr,xr,Rr,_r,Fr,Nr=u.ccclass,Ar=u.property,Dr=(mr=Nr("ClockTimerUI"),yr=Ar(H),mr((Pr=t((br=function(t){function r(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"timeText",Pr,i(e)),e.time=0,e}e(r,t);var s=r.prototype;return s.showFadeIn=function(t){Jt(this.node,t,1,255,Kt(2)).start()},s.startTiming=function(t,e,n){var i=this;T(this.node).by(t,he.props.empty,{onUpdate:function(e,n){i.time=B(t,0,n),i.timeText.string=""+Math.ceil(i.time)}}).call((function(){null==e||e(),Jt(i.node,.5,-1,0,Kt(2)).call((function(){return null==n?void 0:n()})).start()})).start()},o(r,[{key:"now",get:function(){return this.time}}]),r}(g)).prototype,"timeText",[yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vr=br))||vr);s._RF.pop(),s._RF.push({},"54b3dZegeNNOrVwh3UnBfEW","GoldenGiant",void 0);var Ir,Er,zr,Lr,Or,kr,Wr,Hr,Ur,Gr,Vr,Xr=u.ccclass,qr=u.property,Zr=O.WrapMode;Tr=Xr("GoldenGiant"),Br=qr(_),Cr=qr(_),Tr((_r=t((Rr=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"attackFxPrefab",_r,i(e)),n(e,"clockTimerUIPrefab",Fr,i(e)),e.canShowHurt=!0,e.tagAttack=1247,e}e(o,t);var r=o.prototype;return r.postInit=function(){var t=this;this.using=!1,this.canShowHurt=!1;var e=Te.effectMgr,n=this.monsterAnims,i=oe(n[0],"Root/Bip001");te(this.node,.75,(function(){e.playWaterSplashFx(i.worldPosition,M.randomRange(3.5,4.5),!1)})),Gt(n[0],"BossIngame",Zr.Normal,(function(){t.using=!0,t.playIdle()})),Te.sndMgr.playMusic("BGM_Boss",!0),Te.sndMgr.playOneShot("Water_Splash_Big"),ee(this.node,.333,(function(){var n=Te.monsterMgr.getAllEntities().filter((function(e){return e.getID()!==t.id}));e.makeMonsterFly(i.worldPosition,n),fr(Te.cam3D.node,1.2,25,10,.97),Te.sndMgr.playOneShot("Giant_Water")})),ee(this.node,45,(function(){var e=N(t.clockTimerUIPrefab);e.setParent(Te.node.noticeLayer),e.setPosition(0,270,0);var n=e.getComponent(Dr);n.startTiming(15,(function(){return t.playDead()}),(function(){return n.destroy()})),n.showFadeIn(.5)}))},r.playIdle=function(){var t=this,e=this.monsterAnims;if(Math.random()<.6)this.canShowHurt=!0,Gt(e[0],"BossIdle01",Zr.Normal,(function(){t.playIdle()}));else{this.canShowHurt=!1;var n=qt(["BossIdle02","BossIdle03"]);Gt(e[0],n,Zr.Normal,(function(){t.playIdle()})),"BossIdle02"===n&&ee(this.node,.15,(function(){fr(Te.cam3D.node,1,25,4,.97),Te.sndMgr.playOneShot("Giant_Yell")})),"BossIdle03"===n&&ee(this.node,1.8,(function(){Te.sndMgr.playOneShot("Giant_Head")}))}},r.playDead=function(){var t=this;this.using=!1,this.canShowHurt=!1,this.colliders.forEach((function(t){return t.enabled=!1})),this.stopMove(),Te.monsterMgr.removeFromEntitiesMap(this.id),A.stopAllByTag(this.tagAttack,this.node),ee(this.node,2.8,(function(){fr(Te.cam3D.node,1,25,6,.97),Te.sndMgr.playOneShot("Giant_Water")})),Gt(this.monsterAnims[0],"BossDead",Zr.Normal,(function(){var e,n=null!=(e=Te.getValue("Main_BGM"))?e:"";Te.sndMgr.playMusic(n,!0),t.sinkAllEntities(),T(t.node.children[0]).by(.8,{position:v(0,-150,0)},{easing:Kt(2)}).call((function(){t.node.children[0].setPosition(0,0,0),t.pushToPool()})).start()}))},r.sinkAllEntities=function(){var t=this,e=Te.effectMgr,n=Te.effectMgr.getWaterHeight(),i=v();Te.monsterMgr.getAllEntities().forEach((function(o){o.getID()!==t.id&&(o.stopMove(),o.setUsing(!1),o.colliders.forEach((function(t){return t.enabled=!1})),ee(o.node,.4,(function(){i.set(o.node.worldPosition),i.y=n,e.playWaterSplashFx(i,1,!1)})),T(o.node.children[0]).by(.8,he.props.position_0_n100_0).call((function(){o.node.children[0].setPosition(0,0,0),o.pushToPool()})).start())}))},r.showHurt=function(t){var e=this;if(this.using&&(this.damageTint(!0),this.canShowHurt))for(var n=this.monsterAnims,i=Math.min(t,3),o=0;o<i;++o)if(Math.random()<.15){Te.sndMgr.playOneShot(this.getHurtSndName()),Gt(n[0],"BossHurt",Zr.Normal,(function(){e.playIdle()}));break}},r.showReward=function(t){var e=this;this.using=!1,this.canShowHurt=!1,this.colliders.forEach((function(t){return t.enabled=!1}));var n=this.monsterAnims,i=oe(n[0],"Root/Bip001"),o=Ut(Te.cam3D,Te.cam2D,i.worldPosition);return o.y+=60,Te.effectMgr.showBossGetCoins(o,t,(function(){Te.gameCtrl.addPlayerCoins(t),Te.uiCtrl.updatePlayerCoins()})),Te.sndMgr.playOneShot(this.getHurtSndName()),Gt(n[0],"BossAttack",Zr.Normal,(function(){e.using=!0,e.canShowHurt=!0,e.colliders.forEach((function(t){return t.enabled=!0})),e.playIdle()})),A.stopAllByTag(this.tagAttack,this.node),T(this.node).delay(1.4).call((function(){var t=N(e.attackFxPrefab),n=t.scale;t.setParent(Te.node.effect3DLayer),t.setScale(n.x,-n.y,n.z),Gt(t,"",Zr.Normal,(function(){return t.destroy()})),Te.sndMgr.playOneShot("Giant_Attack"),ee(e.node,.1,(function(){var t=Te.monsterMgr.getAllEntities().filter((function(t){return t.getID()!==e.id})).filter((function(t){return t.node.position.x<0}));Te.effectMgr.makeMonsterFly(i.worldPosition,t),fr(Te.cam3D.node,.8,25,5),ee(Te.gameCtrl.timer,.3,(function(){Te.sndMgr.playOneShot("Water_Splash_Big")}))}))})).delay(.6).call((function(){var t=N(e.attackFxPrefab);t.setParent(Te.node.effect3DLayer),Gt(t,"",Zr.Normal,(function(){return t.destroy()})),ee(e.node,.1,(function(){var t=Te.monsterMgr.getAllEntities().filter((function(t){return t.getID()!==e.id})).filter((function(t){return t.node.position.x>0}));Te.effectMgr.makeMonsterFly(i.worldPosition,t),fr(Te.cam3D.node,.8,25,5),ee(Te.gameCtrl.timer,.3,(function(){Te.sndMgr.playOneShot("Water_Splash_Big")}))}))})).tag(1247).start(),!0},r.showDeath=function(){},r.getHurtSndName=function(){return"Giant_Hurt_0"+Xt(1,2)},o}(mn)).prototype,"attackFxPrefab",[Br],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fr=t(Rr.prototype,"clockTimerUIPrefab",[Cr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xr=Rr));s._RF.pop(),s._RF.push({},"ba352QJP2hI/57jk4wRXEdj","Medusa",void 0);var jr,Yr=O.WrapMode,Kr=u.ccclass,Jr=u.property;Ir=Kr("Medusa"),Er=Jr(x),zr=Jr(_),Lr=Jr(_),Or=Jr(_),Ir((Hr=t((Wr=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"heartFxNode",Hr,i(e)),n(e,"petrificationFxPrefab",Ur,i(e)),n(e,"magicLightFxPrefab",Gr,i(e)),n(e,"stoneBrokenFxPrefab",Vr,i(e)),e}e(o,t);var s=o.prototype;return s.init=function(e,n){t.prototype.init.call(this,e,n),this.oddsIndex=M.randomRangeInt(0,this.oddsList.length),this.oddsText.string="X"+Zt(this.oddsList)},s.playIdle=function(){var t=this.monsterAnims;if(Math.random()<.333)Gt(t[0],"idle01");else{var e=qt(["idle02","idle03"]);Gt(t[0],e,Yr.Normal,(function(){Gt(t[0],"idle01")})),"idle03"===e&&Gt(this.heartFxNode,"",Yr.Normal)}},s.showReward=function(t){var e=this;this.using=!1,this.canShowHurt=!1,this.colliders.forEach((function(t){return t.enabled=!1})),Te.monsterMgr.removeFromEntitiesMap(this.id);var n=this.monsterAnims,i=this.node,o=Ut(Te.cam3D,Te.cam2D,i.worldPosition),r=N(this.petrificationFxPrefab);return r.setParent(Te.node.effect2DLayer),r.setWorldPosition(o),Gt(r,"",Yr.Normal,(function(){r.destroy()})),T(r).delay(.5).call((function(){Te.sndMgr.playOneShot("Medusa_01")})).to(.25,{position:v(0,60,0)}).call((function(){Te.sndMgr.playOneShot("Medusa_02")})).start(),this.stopFloating(),Gt(n[0],"attack",Yr.Normal),ee(i,.7,(function(){return e.showPetrification()})),ee(i,2.7,(function(){e.reuse=!1,Te.sndMgr.playOneShot("Water_Splash_Small"),Gt(e.commonAnim,"NoFallDead",null,(function(){i.destroy()}));var n=Te.effectMgr,o=n.getWaterHeight(),r=Te.uiCtrl.getPlayerCoinUIWpos3D(),s=v(i.worldPosition);s.y=o,s.z+=40,n.showGetCoins(s,r,t,(function(){Te.gameCtrl.addPlayerCoins(t),Te.uiCtrl.updatePlayerCoins()})),ee(i,.3,(function(){var t=v(i.worldPosition);t.y=o,Te.effectMgr.playWaterSplashFx(t,2,!1)}))})),!0},s.showPetrification=function(){var t=this,e=this.node,n=Ut(Te.cam3D,Te.cam2D,e.worldPosition),i=Te.monsterMgr.getEntitiesInRange(n,700,this.getOdds()),o=Te.effectMgr.getWaterHeight(),s=Te.uiCtrl.getPlayerCoinUIWpos3D(),a=this.stoneBrokenFxPrefab;ee(Te.gameCtrl.timer,2,(function(){fr(Te.cam3D.node,.8,25,4,.97)}));for(var l,u=function(){var e=l.value;if(!e.isUsing()||!e.node)return"continue";e.setUsing(!1),e.colliders.forEach((function(t){return t.enabled=!1})),Te.monsterMgr.removeFromEntitiesMap(e.getID());var n=N(t.magicLightFxPrefab);n.setParent(Te.node.effect3DLayer),n.setWorldPosition(e.node.worldPosition),Qt(n,(function(){e&&e.node&&n.setWorldPosition(e.node.worldPosition)})),Gt(n,"",Yr.Normal,(function(){n.destroy()})),e.monsterAnims.forEach((function(t){return t.stop()})),e.setGrayScale(1),e.setReuse(!1),T(e.node).delay(2).call((function(){var t=N(a);t.setParent(Te.node.effect3DLayer),t.setWorldPosition(e.node.worldPosition);var n,i,o,r=t.position;n=t,i=r.y+30,o=n.position,n.setPosition(o.x,i,o.z),n.position,Gt(t,"",Yr.Normal,(function(){t.destroy()}))})).delay(.1).call((function(){e.monsterAnims[0].node.setPosition(0,-1e5,0);var t=v(e.node.worldPosition);t.y=o,t.z+=40,Te.effectMgr.showGetCoins(t,s,0),t.z-=40,ee(e.node,.4,(function(){Te.effectMgr.playWaterSplashFx(t,1,!1)})),T(e.node.children[0]).by(.8,he.props.position_0_n100_0).call((function(){return e.node.destroy()})).start()})).start()},c=r(i);!(l=c()).done;)u()},s.showDeath=function(){},o}(er)).prototype,"heartFxNode",[Er],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ur=t(Wr.prototype,"petrificationFxPrefab",[zr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Gr=t(Wr.prototype,"magicLightFxPrefab",[Lr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vr=t(Wr.prototype,"stoneBrokenFxPrefab",[Or],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kr=Wr));s._RF.pop(),s._RF.push({},"dd5ab+VncJNL62qvX8nNZBZ","NormalMonster",void 0);var Qr,$r=u.ccclass;u.property,$r("NormalMonster")(jr=function(t){function n(){return t.apply(this,arguments)||this}return e(n,t),n.prototype.init=function(e,n){t.prototype.init.call(this,e,n),this.oddsIndex=0,this.oddsText.string="X"+this.getOdds()},n}(er));s._RF.pop(),s._RF.push({},"94712DiPYlOmbWcQipkuTnf","Timeline",void 0);var ts,es,ns,is,os,rs,ss,as,ls,us,cs,hs,ds,ps=u.ccclass;u.property,ps("Timeline")(Qr=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this).id=1,e.myTween=null,e}e(n,t);var i=n.prototype;return i.onDestroy=function(){var t;null==(t=this.myTween)||t.stop(),this.myTween=null},i.start=function(){var t=this;Qt(this.node,(function(e){Te.gameCtrl.isReadyToPlay()&&(t.startRunning(),e.stop())}))},i.startRunning=function(){var t=this;this.myTween=te(this.node,153,(function(){t.playScript_GoldenGiant()}))},i.playScript_GoldenGiant=function(){var t=this,e=Te.monsterMgr,n=new x("Script_1");n.setParent(this.node),te(n,18.9,(function(){jt(1,2,(function(i){ee(n,.1,(function(){return e.addEntity(Vo,t.id++,i)})),ee(n,2.1,(function(){return e.addEntity(Xo,t.id++,i)})),ee(n,4.1,(function(){return e.addEntity(Vo,t.id++,i)})),ee(n,6.1,(function(){return e.addEntity(Xo,t.id++,i)})),ee(n,8.2,(function(){return e.addEntity(qo,t.id++,i)})),ee(n,10.7,(function(){return e.addEntity(Zo,t.id++,i)})),ee(n,13.5,(function(){return e.addEntity(jo,t.id++,i)})),ee(n,16.5,(function(){return e.addEntity(Yo,t.id++,i)}))}))})),ee(n,87,(function(){Te.gameCtrl.getPlayerTurret().setLock(!0),Te.effectMgr.showBossComing(200,(function(){Te.gameCtrl.getPlayerTurret().setLock(!1)}))})),ee(n,90,(function(){A.stopAllByTarget(n),e.addEntity(Ko,t.id++,101),te(n,17.9,(function(){jt(3,4,(function(i){ee(n,.1,(function(){return e.addEntity(Vo,t.id++,i)})),ee(n,3.1,(function(){return e.addEntity(Xo,t.id++,i)})),ee(n,6.1,(function(){return e.addEntity(Vo,t.id++,i)})),ee(n,9.1,(function(){return e.addEntity(Xo,t.id++,i)})),ee(n,12.2,(function(){return e.addEntity(qo,t.id++,i)})),ee(n,15.5,(function(){return e.addEntity(Zo,t.id++,i)}))}))})),te(n,20.4,(function(){jt(5,6,(function(i){ee(n,.1,(function(){return e.addEntity(Zo,t.id++,i)})),ee(n,4,(function(){return e.addEntity(qo,t.id++,i)})),ee(n,7.6,(function(){return e.addEntity(Xo,t.id++,i)})),ee(n,11.1,(function(){return e.addEntity(Vo,t.id++,i)})),ee(n,14.6,(function(){return e.addEntity(Xo,t.id++,i)})),ee(n,18.1,(function(){return e.addEntity(Vo,t.id++,i)}))}))})),ee(n,54,(function(){A.stopAllByTarget(n),n.destroy()}))}))},n}(g));s._RF.pop(),s._RF.push({},"065aaClfoVGGaktqR57EFic","GlowFx",void 0);var fs,gs=u.ccclass,ms=u.property;ts=gs("GlowFx"),es=ms(c),ns=ms($),is=ms($),ts((ss=t((rs=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"meshRenderer",ss,i(e)),n(e,"materialIdx",as,i(e)),n(e,"bleaching",ls,i(e)),n(e,"glowing",us,i(e)),n(e,"moving",cs,i(e)),n(e,"offset",hs,i(e)),n(e,"tiling",ds,i(e)),e.lastBleaching=0,e.lastGlowing=0,e.material=null,e.uv=b(),e}e(o,t);var r=o.prototype;return r.start=function(){var t=this.meshRenderer;t&&(this.material=t.getMaterialInstance(this.materialIdx));var e=this.material;e&&(e.setProperty("offset",this.offset,0),e.setProperty("tiling",this.tiling,0),this.uv.set(this.offset))},r.update=function(t){var e=this.material;if(e){var n=this.bleaching,i=this.glowing,o=this.moving,r=this.uv;this.lastBleaching!==n&&(e.setProperty("bleaching",n,0),this.lastBleaching=n),this.lastGlowing!==i&&(e.setProperty("glowing",i,0),this.lastGlowing=i),0===o.x&&0===o.y||(r.x=(r.x+o.x*t)%1,r.y=(r.y+o.y*t)%1,e.setProperty("offset",r,0))}},o}(g)).prototype,"meshRenderer",[es],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),as=t(rs.prototype,"materialIdx",[ms],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ls=t(rs.prototype,"bleaching",[ms],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),us=t(rs.prototype,"glowing",[ms],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),cs=t(rs.prototype,"moving",[ns],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return b(0,0)}}),hs=t(rs.prototype,"offset",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return b(0,0)}}),ds=t(rs.prototype,"tiling",[ms],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),os=rs));s._RF.pop(),s._RF.push({},"ce586Jwu4dHL69MYH0RNiIy","SceneExtent",void 0);var ys=u.ccclass;u.property,ys("SceneExtent")(fs=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this).oldScale=v(),e}e(n,t);var i=n.prototype;return i.onLoad=function(){this.oldScale.set(this.node.scale)},i.onEnable=function(){this.onResize(),Te.node.stage.on(x.EventType.SIZE_CHANGED,this.onResize,this)},i.onDisable=function(){Te.node.stage.off(x.EventType.SIZE_CHANGED,this.onResize,this)},i.onResize=function(){var t=tt.getDesignResolutionSize(),e=ne(Te.node.stage,-1,-1),n=this.oldScale,i=e.width/t.width;this.node.setScale(n.x*i,n.y,n.z)},n}(g));s._RF.pop(),s._RF.push({},"d802f8UQk1C6afEpPbXOJvq","LabelBitmapAtlas",void 0);var vs,bs,Ps=function(){function t(t,e){this.texture=null,this.textureBleeding=!0,this.space=1,this.freeRects=[],this.labelRectCache=new Map,this.isFull=!1;var n=new ws;n.initWithSize(t,e),this.texture=n,this.freeRects.push(et(0,0,t,e))}var e=t.prototype;return e.insert=function(t){if(!this.isPackable(t))return null;var e=t.ttfSpriteFrame,n=e.texture,i=this.texture,o=this.space,r=2*o,s=n.width+r,a=n.height+r;if(i.width<s)return null;if(i.height<a)return null;var l=0,u=0,c=this.labelRectCache.get(t);if(c&&c.height>=a&&c.width>=s)l=c.x+o,u=c.y+o,this.drawImageAt(n.image,l,u);else{this.remove(t);var h=this.getBestRect(s,a);if(-1===h){if(this.isFull)return null;this.isFull=!0,this.repack();var d=this.insert(t);return this.isFull=!d,d}var p=this.freeRects[h];l=p.x+o,u=p.y+o,this.drawImageAt(n.image,l,u),this.freeRects.splice(h,1),this.splitIntoFreeRects(p,s,a),this.labelRectCache.set(t,et(p.x,p.y,s,a))}var f=e.rect.clone();f.x+=l,f.y+=u;var g=new nt;return g.texture=i,g.rect=f,g.packable=!1,g},e.remove=function(t){var e=this.labelRectCache.get(t);e&&(this.freeRects.push(e),this.labelRectCache.delete(t),this.isFull=!1)},e.repack=function(){var t=this.texture,e=t.width,n=t.height;this.freeRects.length=0,this.freeRects.push(et(0,0,e,n));var i=Array.from(this.labelRectCache.keys()).filter((function(t){return t.enabledInHierarchy})).sort((function(t,e){var n=t.ttfSpriteFrame.rect;return e.ttfSpriteFrame.rect.height-n.height}));this.labelRectCache.clear();for(var o,s=r(i);!(o=s()).done;){o.value.node.emit("update-inner-sprite",!0)}},e.isPackable=function(t){return t.ttfSpriteFrame&&t.cacheMode===H.CacheMode.NONE&&""!==t.string},e.getBestRect=function(t,e){for(var n=-1,i=Number.MAX_VALUE,o=0,r=this.freeRects.length;o<r;++o){var s=this.freeRects[o];if(!(s.height<e||s.width<t)){var a=s.height-e;a<i&&(i=a,n=o)}}return n},e.splitIntoFreeRects=function(t,e,n){var i=et(t.x,t.y+n,t.width,t.height-n),o=et(t.x+e,t.y,t.width-e,n);this.freeRects.push(i),this.freeRects.push(o)},e.drawImageAt=function(t,e,n){var i=this.texture;if(this.textureBleeding){var o=t.width,r=t.height;(o<=8||r<=8)&&(i.drawTextureAt(t,e-1,n-1),i.drawTextureAt(t,e-1,n+1),i.drawTextureAt(t,e+1,n-1),i.drawTextureAt(t,e+1,n+1)),i.drawTextureAt(t,e-1,n),i.drawTextureAt(t,e+1,n),i.drawTextureAt(t,e,n-1),i.drawTextureAt(t,e,n+1)}i.drawTextureAt(t,e,n)},t}(),ws=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var i=n.prototype;return i.initWithSize=function(t,e,n){void 0===n&&(n=it.PixelFormat.RGBA8888),this.reset({width:t,height:e,format:n})},i.drawTextureAt=function(t,e,n){var i=this.getGFXTexture();if(t&&i){var o=this._getGFXDevice();if(o){var r=new p.BufferTextureCopy;r.texOffset.x=e,r.texOffset.y=n,r.texExtent.width=t.width,r.texExtent.height=t.height,o.copyTexImagesToTexture([t.data],i,[r])}}},n}(it);s._RF.pop(),s._RF.push({},"bff92KP9EJFQ6/76WiJo/eS","BitmapLabel",void 0);var Ss=[ot(1024,512),ot(1024,1024),ot(1024,2048),ot(2048,2048)],Ms=0,Ts=null,Bs=Ss[0],Cs=Bs.width,xs=Bs.height;Ts=new Ps(Cs,xs);var Rs,_s=u.ccclass;u.property,_s("BitmapLabel")(((bs=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this).enableBitmapChangedEvent=!1,e.innerString="",e}e(n,t);var i=n.prototype;return i.onLoad=function(){var e;null==(e=t.prototype.onLoad)||e.call(this),this.cacheMode=rt.NONE},i.onEnable=function(){var e;null==(e=t.prototype.onEnable)||e.call(this);var n=this.getSuperString();n!==this.innerString&&(this.innerString=n,this.updateInnerSprite()),this.node.on("update-inner-sprite",this.updateInnerSprite,this)},i.onDisable=function(){var e;this.node.off("update-inner-sprite",this.updateInnerSprite,this),Ts.remove(this),this.clearInnerSprite(),this.setSuperString(this.innerString),this.innerString="",null==(e=t.prototype.onDisable)||e.call(this)},i.updateInnerSprite=function(t){var e=this;if(void 0===t&&(t=!1),this.clearInnerSprite(),""!==this.innerString){var n=function t(){var n=Ts.insert(e);if(n){var i=e.getInnerSprite();i.spriteFrame=n,e.enableBitmapChangedEvent&&e.node.emit("bitmap-changed",i),e.setSuperString("")}else{if(Ms<Ss.length-1){var o=Ss[Ms+1],r=o.width,s=o.height;Ms+=1,function(t,e){if(Ts){Ts.texture.destroy();var n=new ws;n.initWithSize(t,e),Ts.texture=n,Ts.repack()}}(r,s),t()}}};t?n():k.once(st.EVENT_END_FRAME,n)}},i.getInnerSprite=function(){var t=n.innerSpriteName,e=this.node.getChildByName(t);return e?e.getComponent(at):this.addInnerSprite()},i.addInnerSprite=function(){var t=new x(n.innerSpriteName),e=t.addComponent(P),i=t.addComponent(at),o=this.getComponent(P);return e.setAnchorPoint(o.anchorPoint),t.layer=this.node.layer,t.setParent(this.node),t.setSiblingIndex(0),i},i.clearInnerSprite=function(){var t=this.getInnerSprite();t.spriteFrame&&(t.spriteFrame.destroy(),t.spriteFrame=null,this.enableBitmapChangedEvent&&this.node.emit("bitmap-changed",t))},i.getSuperProperty=function(t,e){return Object.getOwnPropertyDescriptor(t,e)},i.setSuperString=function(t){var e;null==(e=this.getSuperProperty(H.prototype,"string"))||e.set.call(this,t)},i.getSuperString=function(){var t=this.getSuperProperty(H.prototype,"string");return t?t.get.call(this):""},i.setSuperCacheMode=function(t){var e;null==(e=this.getSuperProperty(H.prototype,"cacheMode"))||e.set.call(this,t)},i.getSuperColor=function(){var t=this.getSuperProperty(lt.prototype,"color");return t?t.get.call(this):ut.WHITE},i.setSuperColor=function(t){var e;null==(e=this.getSuperProperty(lt.prototype,"color"))||e.set.call(this,t)},o(n,[{key:"color",get:function(){return this.getSuperColor()},set:function(t){this.setSuperColor(t),this.updateInnerSprite()}},{key:"string",get:function(){var t=this.getSuperString();return""!==t?t:this.innerString},set:function(t){var e=t;""!==e&&e===this.innerString||(this.setSuperString(e),e!==this.innerString&&this.enabledInHierarchy&&(this.innerString=e,this.updateInnerSprite()))}},{key:"cacheMode",get:function(){return rt.NONE},set:function(t){this.setSuperCacheMode(rt.NONE)}}]),n}(H)).innerSpriteName="__INNER_LABEL_SPRITE__",vs=bs));s._RF.pop(),s._RF.push({},"25105/RSTZP2L02gEEuwI8M","CameraResize",void 0);var Fs,Ns,As,Ds=u.ccclass;u.property,Ds("CameraResize")(Rs=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this).camera=null,e.hypotenuse=-1,e}e(n,t),n.updateScene=function(){k.getScene().getComponentsInChildren(n).forEach((function(t){return t.onResize()}))};var i=n.prototype;return i.onLoad=function(){this.camera=this.node.getComponent(q)},i.onDestroy=function(){this.camera=null},i.onEnable=function(){this.onResize(),tt.on("canvas-resize",this.onResize,this)},i.onDisable=function(){tt.off("canvas-resize",this.onResize,this)},i.onResize=function(){this.camera.projection===q.ProjectionType.ORTHO?this.orthoResize():this.perspectiveResize()},i.orthoResize=function(){var t=this.camera,e=ct.windowSize,n=Nt.scale;t.orthoHeight=e.height*n/tt.getScaleY()/2},i.perspectiveResize=function(){var t=this.camera;-1===this.hypotenuse&&(this.hypotenuse=Math.tan(t.fov/2*ht.RAD));var e=ct.windowSize,n=tt.getDesignResolutionSize(),i=n.width/n.height,o=1;e.width/e.height<=i&&(o=e.width/ct.devicePixelRatio/(e.height/ct.devicePixelRatio*i));var r=Nt.scale,s=Math.atan(this.hypotenuse/o)*ht.DEG*2*r;t.fovAxis=dt.scene.CameraFOVAxis.VERTICAL,t.fov=s},n}(g));s._RF.pop(),s._RF.push({},"7ebc3OmBg5GbL32Y8ORTu42","LabelSpacingX",void 0);var Is,Es=u.ccclass,zs=u.property,Ls=u.executeInEditMode,Os=u.requireComponent;Es("LabelSpacingX")(Fs=Os(H)(Fs=Ls((As=t((Ns=function(t){function r(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"_spacingX",As,i(e)),e}e(r,t);var s=r.prototype;return s.onEnable=function(){this.resetSpacingX()},s.resetSpacingX=function(){var t=this.node.getComponent(H);t&&t.cacheMode===H.CacheMode.CHAR&&(t.spacingX=this._spacingX)},o(r,[{key:"spacingX",get:function(){return this._spacingX},set:function(t){this._spacingX=t,this.resetSpacingX()}}]),r}(g)).prototype,"_spacingX",[zs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),t(Ns.prototype,"spacingX",[zs],Object.getOwnPropertyDescriptor(Ns.prototype,"spacingX"),Ns.prototype),Fs=Ns))||Fs)||Fs);s._RF.pop(),s._RF.push({},"70fa928PtNCcZvsXNQKVFFh","SceneViewResize",void 0);var ks,Ws,Hs,Us,Gs,Vs,Xs,qs,Zs,js,Ys,Ks=u.ccclass,Js=(u.property,u.requireComponent),Qs=Ks("SceneViewResize")(Is=Js(P)(Is=function(t){function n(){return t.apply(this,arguments)||this}e(n,t);var i=n.prototype;return i.onEnable=function(){this.onResize(),tt.on("canvas-resize",this.onResize,this)},i.onDisable=function(){tt.off("canvas-resize",this.onResize,this)},i.onResize=function(){var t=ct.devicePixelRatio,e=ct.windowSize,n=tt.getDesignResolutionSize(),i=ot(e.width/t,e.height/t),o=i.width/i.height,r=n.width/n.height,s=o>r,a=!1===s&&o!==r,l=Nt,u=l.maxLongSideRate,c=l.maxShortSideRate,h=ot(n);if(!0===s){var d=h.height*u,p=h.height*o;h.width=Math.floor(Math.min(p,d))}if(!0===a){var f=h.width*c,g=h.width/o;h.height=Math.floor(Math.min(g,f))}this.node.getComponent(P).setContentSize(h)},n}(g))||Is)||Is;s._RF.pop(),s._RF.push({},"34e9bj9PbpAB7jFZUXrqZCj","SceneViewBorder",void 0);var $s,ta,ea,na,ia,oa=u.ccclass,ra=u.property;ks=oa("SceneViewBorder"),Ws=ra(P),Hs=ra(P),Us=ra(P),Gs=ra(P),ks((qs=t((Xs=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"left",qs,i(e)),n(e,"right",Zs,i(e)),n(e,"top",js,i(e)),n(e,"bottom",Ys,i(e)),e}e(o,t);var r=o.prototype;return r.onEnable=function(){this.onResize(),tt.on("canvas-resize",this.onResize,this)},r.onDisable=function(){tt.off("canvas-resize",this.onResize,this)},r.onResize=function(){var t=ct.devicePixelRatio,e=ct.windowSize,n=tt.getDesignResolutionSize(),i=ot(e.width/t,e.height/t),o=i.width/i.height,r=n.width/n.height,s=o>r,a=!s&&!pt(o,r),l=k.getScene().getComponentInChildren(Qs).node.getComponent(P).contentSize,u=Nt,c=u.maxLongSideRate,h=u.maxShortSideRate,d=Math.min(n.width,n.height)*c,p=Math.max(n.width,n.height)*h;if(!1===n.width>n.height){var f=[p,d];d=f[0],p=f[1]}if(this.closeAllBoarders(),!0===s){var g=n.height/i.height,m=i.width*g;if(m>d){var y=(m-d)/2+50;this.openLeftRightBoarders(l,y)}}if(!0===a){var v=n.width/i.width,b=i.height*v;if(b>p){var w=(b-p)/2+50;this.openTopBottomBoarders(l,w)}}},r.openLeftRightBoarders=function(t,e){var n=this.left,i=this.right;n.node.active=!0,i.node.active=!0,n.node.setPosition(-Math.floor(t.width/2),n.node.position.y),i.node.setPosition(Math.floor(t.width/2),i.node.position.y),n.setContentSize(e,t.height),i.setContentSize(e,t.height)},r.openTopBottomBoarders=function(t,e){var n=this.top,i=this.bottom;n.node.active=!0,i.node.active=!0,n.node.setPosition(n.node.position.x,Math.floor(t.height/2)),i.node.setPosition(i.node.position.x,-Math.floor(t.height/2)),n.setContentSize(t.width,e),i.setContentSize(t.width,e)},r.closeAllBoarders=function(){this.left.node.active=!1,this.right.node.active=!1,this.top.node.active=!1,this.bottom.node.active=!1},o}(g)).prototype,"left",[Ws],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Zs=t(Xs.prototype,"right",[Hs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),js=t(Xs.prototype,"top",[Us],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ys=t(Xs.prototype,"bottom",[Gs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vs=Xs));s._RF.pop(),s._RF.push({},"6169ee5JrVJjZ/zn6vYo383","ScreenCursor",void 0);var sa,aa=u.ccclass,la=u.property;$s=aa("ScreenCursor"),ta=la({type:x,tooltip:"鼠標圖示節點"}),$s((ia=t((na=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"cursorNode",ia,i(e)),e.loc=b(),e.isShow=!1,e}e(o,t);var r=o.prototype;return r.onEnable=function(){var t=a.isBrowser&&!a.isMobile;if(this.node.active=t,this.isShow=t,t){var e=tt.getDesignResolutionSize(),n=2*Math.max(e.width,e.height);this.node.getComponent(P).setContentSize(n,n),this.node.on(x.EventType.MOUSE_MOVE,this.updatePositionByMouse,this),document.body.style.cursor="none"}},r.onDisable=function(){this.isShow&&this.node.off(x.EventType.MOUSE_MOVE,this.updatePositionByMouse,this)},r.updatePositionByMouse=function(t){var e=t.getUILocation(this.loc);this.cursorNode.setWorldPosition(e.x,e.y,0)},o}(g)).prototype,"cursorNode",[ta],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ea=na));s._RF.pop(),s._RF.push({},"eddb44fuedAkaRRnjMbkOmr","SpeedUpTest",void 0);var ua,ca,ha,da,pa,fa=u.ccclass;u.property,fa("SpeedUpTest")(sa=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this).moreTimes=0,e.isSpeedingUp=!1,e}e(n,t);var i=n.prototype;return i.onLoad=function(){At.isDevTest&&G.on(V.EventType.KEY_DOWN,this.onKeyDown,this)},i.onDestroy=function(){At.isDevTest&&G.off(V.EventType.KEY_DOWN,this.onKeyDown,this)},i.lateUpdate=function(t){if(!(this.moreTimes<=0||this.isSpeedingUp)){this.isSpeedingUp=!0;for(var e=0,n=this.moreTimes;e<n;++e)U.step();this.isSpeedingUp=!1}},i.onKeyDown=function(t){if(t.keyCode===X.F8){this.moreTimes=this.moreTimes<=0?7:0}},n}(g));s._RF.pop(),s._RF.push({},"23681h4cBRJwZT9Z0yN+YOx","StaticMeshBatcher",void 0);var ga=u.ccclass,ma=u.property;ua=ga("StaticMeshBatcher"),ca=ma({tooltip:"當合併完成時, 是否銷毀自身節點"}),ua((pa=t((da=function(t){function o(){for(var e,o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,n(e,"destroySelf",pa,i(e)),e}return e(o,t),o.prototype.start=function(){var t=this.node,e=new x(t.name+"_Batched");if(e.layer=t.layer,e.setParent(t.parent),e.setSiblingIndex(t.getSiblingIndex()),e.setRTS(t.rotation,t.position,t.scale),!ft.batchStaticModel(t,e))return gt("Meshes are batching failed."),void e.destroy();this.destroySelf&&t.destroy()},o}(g)).prototype,"destroySelf",[ca],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ha=da));s._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/game', 'chunks:///game.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});